function loadEmailSendTagInputs(){var n=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("text"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,prefetch:{url:"/tickets/PrefetchContactEmails",prepare:function(n){return n.type="POST",n.contentType="application/json; charset=UTF-8",n},remote:function(n,t){return t.type="POST",t.data={q:n,foo:"bar"},t}}});n.clear();n.clearPrefetchCache();n.clearRemoteCache();n.initialize();eltTo=$("#EmailSendTo");eltTo.tagsinput({itemValue:"value",itemText:"text"});eltTo.tagsinput("input").typeahead(null,{name:"EmailSendTo",valueKey:"value",displayKey:"text",source:n.ttAdapter(),templates:"<p>{{text}}<\/p>"}).bind("typeahead:selected",$.proxy(function(n,t){this.tagsinput("add",t);this.tagsinput("input").typeahead("val","")},eltTo));eltCC=$("#EmailSendCC");eltCC.tagsinput({itemValue:"value",itemText:"text"});eltCC.tagsinput("input").typeahead(null,{name:"EmailSendCC",valueKey:"value",displayKey:"text",source:n.ttAdapter(),templates:"<p>{{text}}<\/p>"}).bind("typeahead:selected",$.proxy(function(n,t){this.tagsinput("add",t);this.tagsinput("input").typeahead("val","")},eltCC));eltBCC=$("#EmailSendBCC");eltBCC.tagsinput({itemValue:"value",itemText:"text"});eltBCC.tagsinput("input").typeahead(null,{name:"EmailSendBCC",valueKey:"value",displayKey:"text",source:n.ttAdapter(),templates:"<p>{{text}}<\/p>"}).bind("typeahead:selected",$.proxy(function(n,t){this.tagsinput("add",t);this.tagsinput("input").typeahead("val","")},eltBCC))}jQuery(function(){var i,r,n,t;$(".CC").hide();$(".BCC").hide();i=jQuery("#UserEmailSignature").val();r=$("#Emailbody").html();CKEDITOR.instances.Emailbody.setData("<br/>"+i+"<hr><br/>"+r);loadEmailSendTagInputs();jQuery(document).on("click",".remove-attachment",function(){$(this).closest(".emailattachment").remove();var t=$(this).parent().parent().parent().attr("id");n.delete(t)});jQuery(document).on("click",".cancelemail",function(){jQuery(".view-email-actions").show();jQuery(".send-email-actions").hide();$("#emailType").val("");$(".emailcontainer").show();$("#replayPanel").hide();isCC=!1;isBCC=!1;$("#UploadAttachmentprogress").html("")});n=new FormData;t=1;jQuery("#attachNewFiles").change(function(){var r=document.getElementById("attachNewFiles").files,i,u;for(jQuery(".send-attachments").show(),i=0;i<r.length;i++)n.append("file_"+t,r[i],r[i].name),u="<div id='file_"+t+"' class='btn-group emailattachment newfile' style='margin-bottom: 3px; margin-right: 2px;'><a class='btn bg-slate-400'>"+r[i].name+"<\/a> <button type='button' class='btn bg-slate-400 dropdown-toggle' data-toggle='dropdown' aria-expanded='false'><span class='caret'><\/span><\/button><ul class='dropdown-menu dropdown-menu-right'><li><a class='remove-attachment'><i class='icon-close2'><\/i>Remove Attachment<\/a><\/li><\/ul><\/div>",jQuery(".send-attachments").prepend(u),t++;$("#attachNewFiles").val(null)});jQuery(".btnSendEmail").click(function(){var s=$("#EmailSendTo").val(),i,r,t,o;if(s.indexOf(";")>=0)return new PNotify({title:"Invalid Character",text:"Please Remove ; From TO",type:"warning",hide:!1}),!1;if(i=$("#EmailSendCC").val(),i.indexOf(";")>=0)return new PNotify({title:"Invalid Character",text:"Please Remove ; From CC",type:"warning",hide:!1}),!1;if(r=$("#EmailSendBCC").val(),r.indexOf(";")>=0)return new PNotify({title:"Invalid Character",text:"Please Remove ; From BCC",type:"warning",hide:!1}),!1;if(t=$("#EmailSendTo").val(),!t)new PNotify({title:"Requird Info is Missing",text:"Please Enter To Email Address",type:"warning",hide:!1});else{var h=$("#SentItemID").val(),c=$("#emailType").val(),u="",f="";f=isCC?$("#EmailSendCC").val():"";u=isBCC?$("#EmailSendBCC").val():"";var l=$("#EmailSendSubject").val(),a=CKEDITOR.instances.Emailbody.getData(),e="";$(".send-attachments").find(".emailattachment").each(function(n,t){if($(t).hasClass("existingfile")){var i=$(t).attr("id");i=i+"_E";e+=i+","}});o={type:c,TO:t,CC:f,BCC:u,Subject:l,body:a,Attach:e,SentItemID:h};n.append("data",JSON.stringify(o));Swal.fire({title:"Email sending...",allowEscapeKey:!1,allowOutsideClick:!1,showConfirmButton:!1,didOpen:()=>{Swal.showLoading()}});$.ajax({url:"/GraphMails/SendMail/",processData:!1,contentType:!1,data:n,type:"POST"}).done(function(n){if(swal.close(),n.error)return new PNotify({title:"Error",text:n.response,type:"warning",hide:!1}),!1;$("#EmailSendTo").val("");$("#EmailSendCC").val("");$("#EmailSendBCC").val("");$("#EmailSendSubject").val("");$("#Emailbody").val("");window.location.href="http://timesheet.computan.com/tickets/index/1";new PNotify({title:"Success",text:"Email Send Successfully",type:"success",hide:!1});jQuery(".view-email-actions").show();jQuery(".send-email-actions").hide();jQuery(".emailcontainer").show();jQuery(".sendemailcontainer").hide()})}})});