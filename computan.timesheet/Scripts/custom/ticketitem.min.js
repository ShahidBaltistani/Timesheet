function initDefaults(){clearAddTime();loadTaskDetails();loadActiveTicketDetails();loadAssignedToTagInputs();loadEmailSendTagInputs();loadTicketUsers();loadnewTeamsTagInputs();loadTicketnewteam();setInterval(function(){counter>0&&(jQuery(".assignedusersinput").tagsinput("removeAll"),loadTicketUsers(),counter++,counter>5&&(counter=0))},250)}function clearAddTime(){jQuery("#workdate").val(getFormattedDate(new Date));jQuery("#timespentinminutes").val("0");jQuery("#billabletimeinminutes").val("0");jQuery("#description").val("")}function loadEmail(n){$("#btnReplay").show();$("#btnReplayall").show();$("#btnforword").show();$(".hiddenfield").hide();jQuery(".mail-modifiedtime").html(jQuery("#emailcontentwrapper").find("#email-"+n).find(".lastmodifiedtime").html());jQuery(".mail-sender").html(jQuery("#emailcontentwrapper").find("#email-"+n).find(".sender").html());jQuery(".mail-subject").html(jQuery("#emailcontentwrapper").find("#email-"+n).find(".subject").html());jQuery(".mail-to-addresses").html("To: "+jQuery("#emailcontentwrapper").find("#email-"+n).find(".to-addresses").html());jQuery("#emailcontentwrapper").find("#email-"+n).find(".cc-addresses").hasClass("has-data")?jQuery(".mail-cc-addresses").html("Cc: "+jQuery("#emailcontentwrapper").find("#email-"+n).find(".cc-addresses").html()):jQuery(".mail-cc-addresses").hide();jQuery("#emailcontentwrapper").find("#email-"+n).find(".bcc-addresses").hasClass("has-data")?jQuery(".mail-bcc-addresses").html("Cc: "+jQuery("#emailcontentwrapper").find("#email-"+n).find(".bcc-addresses").html()):jQuery(".mail-bcc-addresses").hide();jQuery("#emailcontentwrapper").find("#email-"+n).find(".attachments").hasClass("has-data")?(jQuery(".mail-attachments").html(""),jQuery("#emailcontentwrapper").find("#email-"+n).find(".attachments").find(".attachment-item").each(function(){jQuery(".mail-attachments").append(jQuery(this).html())})):jQuery(".mail-attachments").hide();var t=jQuery("#emailcontentwrapper").find("#email-"+n).find(".email-body").html();jQuery("#email-body").html(HTMLDecode(t));jQuery("#email-body").find('a[href^="http://"], a[href^="https://"]').attr("target","_blank");jQuery(".emailitem").removeClass("active")}function loadTaskDetails(){var n=jQuery(".startworking").data("projectid"),t=jQuery(".startworking").data("skillid");jQuery("#taskprojectid").val(n).trigger("change");jQuery("#taskskillid").val(t).trigger("change");jQuery("#Assignmenttaskproject").val(n).trigger("change");jQuery("#Assignmenttaskskill").val(t).trigger("change")}function loadActiveTicketDetails(){var n=jQuery(".emailcollection li.active").data("emailid"),t=jQuery(".emailcollection li.active").data("graphemailid");return jQuery("#conversation").val(t),loadEmail(n),jQuery(".emailitem:first").addClass("active"),!1}function loadAssignedToTagInputs(){var n=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("text"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,prefetch:{ttl:1,url:"/tickets/PrefetchUsers",prepare:function(n){return n.type="POST",n.contentType="application/json; charset=UTF-8",n},remote:function(n,t){return t.type="POST",t.data={q:n,foo:"bar"},t}}});n.clear();n.clearPrefetchCache();n.clearRemoteCache();n.initialize();elt=$(".newassignedusersinput");elt.tagsinput({itemValue:"value",itemText:"text"});elt.tagsinput("input").typeahead(null,{name:"assignedusers",valueKey:"value",displayKey:"text",source:n.ttAdapter(),templates:"<p>{{text}}<\/p>"}).bind("typeahead:selected",$.proxy(function(n,t){this.tagsinput("add",t);this.tagsinput("input").typeahead("val","")},elt));elt=$(".assignedusersinput");elt.tagsinput({itemValue:"value",itemText:"text"});elt.tagsinput("input").typeahead(null,{name:"assignedusers",valueKey:"value",displayKey:"text",source:n.ttAdapter(),templates:"<p>{{text}}<\/p>"}).bind("typeahead:selected",$.proxy(function(n,t){this.tagsinput("add",t);this.tagsinput("input").typeahead("val","")},elt))}function loadEmailSendTagInputs(){var n=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("text"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,prefetch:{ttl:1,url:"/tickets/PrefetchContactEmails",prepare:function(n){return n.type="POST",n.contentType="application/json; charset=UTF-8",n},remote:function(n,t){return t.type="POST",t.data={q:n,foo:"bar"},t}}});n.clear();n.clearPrefetchCache();n.clearRemoteCache();n.initialize();eltTo=$("#EmailSendTo");eltTo.tagsinput({itemValue:"value",itemText:"text"});eltTo.tagsinput("input").typeahead(null,{name:"EmailSendTo",valueKey:"value",displayKey:"text",source:n.ttAdapter(),templates:"<p>{{text}}<\/p>"}).bind("typeahead:selected",$.proxy(function(n,t){this.tagsinput("add",t);this.tagsinput("input").typeahead("val","")},eltTo));eltCC=$("#EmailSendCC");eltCC.tagsinput({itemValue:"value",itemText:"text"});eltCC.tagsinput("input").typeahead(null,{name:"EmailSendCC",valueKey:"value",displayKey:"text",source:n.ttAdapter(),templates:"<p>{{text}}<\/p>"}).bind("typeahead:selected",$.proxy(function(n,t){this.tagsinput("add",t);this.tagsinput("input").typeahead("val","")},eltCC));eltBCC=$("#EmailSendBCC");eltBCC.tagsinput({itemValue:"value",itemText:"text"});eltBCC.tagsinput("input").typeahead(null,{name:"EmailSendBCC",valueKey:"value",displayKey:"text",source:n.ttAdapter(),templates:"<p>{{text}}<\/p>"}).bind("typeahead:selected",$.proxy(function(n,t){this.tagsinput("add",t);this.tagsinput("input").typeahead("val","")},eltBCC))}function loadTicketUsers(){user=!1;jQuery(".tua").each(function(){var n=jQuery(this).data("userid"),t=jQuery(this).html();jQuery(".assignedusersinput").tagsinput("add",{value:n,text:t})});user=!0}function loadEstimateTime(){var n=jQuery("#ticketid").val();$.ajax({url:"/Home/FetchEstimatetasktime/",data:{Ticketid:n},type:"GET"}).done(function(n){jQuery("#estimateTimeInput").val(n.estimatetime).trigger("change");jQuery("#EstimateTimeHidden").val(n.estimatetime).trigger("change")})}function loadTicketnewUsers(){jQuery(".newassignedusersinput").tagsinput("removeAll");jQuery(".tua").each(function(){var n=jQuery(this).data("userid"),t=jQuery(this).html();jQuery(".newassignedusersinput").tagsinput("add",{value:n,text:t})})}function loadTicketnewteam(){jQuery(".assignedteaminput").tagsinput("removeAll");jQuery(".tuat").each(function(){var n=jQuery(this).data("userid"),t=jQuery(this).html();jQuery(".assignedteaminput").tagsinput("add",{value:n,text:t})})}function getFormattedDate(n){return("0"+(n.getMonth()+1)).slice(-2)+"/"+("0"+n.getDate()).slice(-2)+"/"+n.getFullYear()}function HTMLDecode(n){return jQuery("<div><\/div>").html(n).text()}function loadnewTeamsTagInputs(){var n=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("text"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,prefetch:{url:"/tickets/PrefetchTeams",prepare:function(n){return n.cache=!1,n.type="POST",n.contentType="application/json; charset=UTF-8",n},remote:function(n,t){return t.cache=!1,t.type="POST",t.data={q:n,foo:"bar"},t}}});n.initialize();elt=$(".assignedteaminput");elt.tagsinput({itemValue:"value",itemText:"text"});elt.tagsinput("input").typeahead(null,{name:"assignedteams",valueKey:"value",displayKey:"text",source:n.ttAdapter(),templates:"<p>{{text}}<\/p>"}).bind("typeahead:selected",$.proxy(function(n,t){this.tagsinput("add",t);this.tagsinput("input").typeahead("val","")},elt))}function loadModalData(){loadTicketnewUsers();loadTicketnewteam();loadEstimateTime()}function reloadAssignment(){$.get("/tickets/TicketItemAssigned?id="+jQuery("#ticketid").val(),function(n){var i=$("#ticketuserscontainer"),t;$(i).html("");$(n.ticketusers).each(function(n,t){var r="<span class='tua' data-userid='"+t.assignedtousersid+"'> "+t.user.FullName+" <\/span>";$(i).append(r)});t=$("#ticketTeamcontainer");$(t).html("");$(n.ticketTeam).each(function(n,i){var r="<span class='tuat' data-userid='"+i.teamid+"'> "+i.team.name+" <\/span>";$(t).append(r)})})}var user=!0,tempz,isreload=!1,counter=0,EditCommentID,EditObj;jQuery(function(){function i(){$(".commentbody").find("img").each(function(n,t){$(t).hasClass("img-responsive")==!1&&$(t).addClass("img-responsive")})}var r,u,f,n,t;jQuery("#projectid").select2();jQuery("#skillid").select2();jQuery("#Assignmenttaskproject").select2();jQuery("#Assignmenttaskskill").select2();jQuery("#StartDate").datepicker();jQuery("#EndDate").datepicker();jQuery("#taskprojectid").select2();jQuery("#taskskillid").select2();jQuery("#workdate").datepicker({maxDate:0});jQuery("#timespentinminutes").numeric({allowMinus:!1,allowThouSep:!1});jQuery("#billabletimeinminutes").numeric({allowMinus:!1,allowThouSep:!1});jQuery("#estimateTimeInput").numeric({allowMinus:!1,allowThouSep:!1});jQuery(document).on("change","#tlcheckbox",function(){if(this.checked){var n=jQuery("#taskprojectid").val(),t=jQuery("#taskskillid").val(),i=jQuery("#timespentinminutes").val(),r=jQuery("#description").val();n<=0&&new PNotify({title:"Error",text:"Please select the project",type:"error",addclass:"stack-bottom-right",hide:!0});t<=0&&new PNotify({title:"Error",text:"Please select the skill",type:"error",addclass:"stack-bottom-right",hide:!0});i==0&&new PNotify({title:"Error",text:"Please enter the time spent",type:"error",addclass:"stack-bottom-right",hide:!0});r==""&&new PNotify({title:"Error",text:"Please enter the task description",type:"error",addclass:"stack-bottom-right",hide:!0})}});jQuery("#commentPermalink").val()!=null&&(r=jQuery("#commentPermalink").val(),u=jQuery(".commentbody").find("#"+r),$("html, body").animate({scrollTop:$(u).offset().top},"slow"));jQuery(".ticketMeta").click(function(){var n=jQuery(this).data("ticketidmeta");$.ajax({url:"/tickets/LoadTicketMeta?TicketId="+n,type:"GET"}).done(function(t){var i,r;if(t.error)return jQuery("#ticketMetaInformation").html(""),jQuery("#ticketMetaInformation").append(JSON.stringify(t.errortext)),!1;jQuery("#ticketMetaInformation").html("");i="";i+="<table class='table table-bordered table-xxs metadatatable'>";i+="<thead>";i+="<tr class='bg-slate-600'>";i+="<th><b>Ticket # "+n+" META information<\/b><\/th><\/tr><\/thead>";i+="<tbody><tr class='active'><td>Last Updated On:<b>"+t.ticketdate+"<\/b><\/td><\/tr>";r=0;$.each(t.TicketMeta,function(n,t){r=r+1;i+=r%2==0?"<tr class='active'><td>"+t.ActionDescription+"<\/td><\/tr>":"<tr class=''><td>"+t.ActionDescription+"<\/td><\/tr>"});i+="<\/tbody><\/table>";jQuery("#ticketMetaInformation").append(i)});$("#ticketMeta").modal("show")});$(".BCC").hide();f=CKEDITOR.replace("txtComments",{extraPlugins:"autolink,autogrow,base64image",autoGrow_minHeight:75,autoGrow_bottomSpace:5,removePlugins:"resize,easyimage, cloudservices",height:"75px",toolbar:[["Font","FontSize","Bold","Italic","Underline","Strike","-","Blockquote","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"],["BidiLtr","BidiRtl"],["TextColor","BGColor"],["customimage","customsmiley","Link","Image"],["Flash","customfiles","Table","-","Outdent","Indent"],["NumberedList","BulletedList","HorizontalRule"],["Styles","Format"],["-"],["Paste","PasteText","PasteFromWord"],["-","Source"],["Maximize"]]});f=CKEDITOR.replace("Emailbody",{height:"500px",extraPlugins:"forms,base64image",removePlugins:"wsc, easyimage, cloudservices",scayt_autoStartup:!0});initDefaults();jQuery("#email-body").find('a[href^="http://"], a[href^="https://"]').attr("target","_blank");jQuery(document).on("change","#taskprojectid",function(){var t=jQuery(this).closest(".sidebar-secondary").data("ticketid"),i=jQuery(this).closest(".sidebar-secondary").data("ticketitemid"),n=$(this).val(),r=$(this).find("option:selected").text(),u='<a class="my-link" href="/project/index/'+n+'" target="_blank"> '+r+' <\/a><i class="fa fa-edit changer"><\/i>';return jQuery.post("/tickets/updateticketproject",{id:t,ticketitemid:i,projectid:n}).done(function(t){t.success?($(".task-project-link").html(u),$(".project-list").removeClass("col-md-12").addClass("col-md-11"),$(".cross").removeClass("hidden"),$("#cprojectid").val(n),new PNotify({title:"Success",text:t.messagetext,type:"success",addclass:"stack-bottom-right",hide:!0})):new PNotify({title:"Error",text:t.messagetext,type:"error",addclass:"stack-bottom-right",hide:!0})}),!1});jQuery(document).on("change","#taskskillid",function(){var n=jQuery(this).closest(".sidebar-secondary").data("ticketid"),t=jQuery(this).closest(".sidebar-secondary").data("ticketitemid"),i=$(this).val();return jQuery.post("/tickets/updateticketskill",{id:n,ticketitemid:t,skillid:i}).done(function(n){n.success||new PNotify({title:"Error",text:n.messagetext,type:"error",addclass:"stack-bottom-right",hide:!1})}),!1});jQuery("#timespentinminutes").on("input",function(){jQuery("#billabletimeinminutes").val(jQuery(this).val())});jQuery("#description").on("focus",function(){jQuery(this).select()});jQuery(document).on("click",".savetime",function(){var n=jQuery(this).closest(".sidebar-secondary").data("ticketitemid"),i=jQuery("#taskprojectid").val(),r=jQuery("#taskskillid").val(),u=jQuery("#workdate").val(),t=jQuery("#timespentinminutes").val(),e=jQuery("#billabletimeinminutes").val(),o=encodeURI(jQuery(".ticket-title").text().trim()),f=jQuery("#description").val(),s=jQuery("#WarningStatus").val(),h=jQuery("#WarningText").val();return n==""||n==0?(new PNotify({title:"Project/Skill Missing",text:"Open <b>Task Details<\/b> section, and select a valid project and skill.",type:"error",addclass:"stack-bottom-right",hide:!1}),!1):i==""?(new PNotify({title:"Project Missing",text:"Open <b>Task Details<\/b> section, and select a valid project.",type:"error",addclass:"stack-bottom-right",hide:!1}),!1):r==""?(new PNotify({title:"Skill Missing",text:"Open <b>Task Details<\/b> section, and select a valid skill.",type:"error",addclass:"stack-bottom-right",hide:!1}),!1):u==""?(new PNotify({title:"Work Date Required",text:"Please select a work date.",type:"error",addclass:"stack-bottom-right",hide:!1}),!1):t==""||t=="0"?(new PNotify({title:"Time Spent",text:"Please enter a valid time spent.",type:"error",addclass:"stack-bottom-right",hide:!1}),!1):f==""?(new PNotify({title:"Description Required",text:"Please enter description.",type:"error",addclass:"stack-bottom-right",hide:!1}),!1):($.ajax({url:"/tickets/addtime/",data:{tcktitemid:n,pid:i,sid:r,spenttime:t,billtime:e,workdate:u,title:o,description:f,comments:""},type:"POST"}).done(function(n){return n.error?(new PNotify({title:"Error",text:n.errortext,type:"error",addclass:"stack-bottom-right",hide:!0}),!1):(swal({title:"Success",text:"Time has been added successfully.",type:"success",confirmButtonColor:"#2196F3"}),clearAddTime(),!1)}),s&&new PNotify({title:"<h1>Warning!<\/h1>",text:"<h3>"+h+"<\/h3>",type:"error",addclass:"stack-bottom-right",hide:!0}),!1)});jQuery(".filteremails").livefilter({selector:".emailcollection li"});jQuery(document).on("click",".emailitem",function(){$(".emailcontainer").show();$("#replayPanel").hide();var n=jQuery(this).data("emailid"),t=jQuery(this).data("graphemailid");return jQuery("#conversation").val(t),jQuery("#ticketdetail").data("ticketitemid",n),loadEmail(n),jQuery(this).addClass("active"),!1});jQuery(document).on("click",".displaycomment",function(){var n=jQuery(this).data("ticketid");$.ajax({url:"/Tickets/loadCommentByTicketId/",data:{id:n},type:"POST"}).done(function(n){$(".commentbody").html("");n.commentlist==""?$(".commentbody").append($.parseHTML("<strong class='Norecordfound'>No record found<\/strong>")):($.each(n.commentlist,function(n,t){var r=$.datepicker.formatDate("mm/dd/yy",new Date(Date(t.commenton))),i="<li class='media' id="+t.id+"><div class='media-left'><a href='#'>";i+=t.ProfileImage!=undefined?"<img id="+t.id+"' src='/Content/images/"+t.ProfileImage+"' class='img-circle img-sm' alt='Not Loaded'>":"<img id="+t.id+"' src='/Content/images/placeholder.jpg' class='img-circle img-sm' alt='Not Loaded'>";i+="<\/a><\/div><div class='media-body'><div class='media-heading'><a href='#' class='text-semibold'> "+t.commentbyusername+"<\/a><span class='media-annotation dotted'>"+r+"<\/span><\/div>";i+="<div id='CommentBody'>"+t.commentbody+"<\/div><br/>";i+="<ul class='list-inline list-inline-separate text-size-small'>";i+="<li class='EditComments' data-id='"+t.id+"'><a>Edit<\/a><\/li><li class='DeleteComments' data-id='"+t.id+"'><a >Delete<\/a><\/li><\/ul><\/div><\/li>";$(".commentbody").append($.parseHTML(i))}),i())})});jQuery(document).on("click",".startworking",function(){var n=jQuery(this).data("projectid"),t=jQuery(this).data("skillid");return $("#projectid").val(n).trigger("change"),$("#skillid").val(t).trigger("change"),jQuery("#startWorkingModal").modal("toggle"),!1});jQuery(document).on("click",".startworkingaction",function(){var r=jQuery(".startworking").data("ticketid"),t=$("#projectid option:selected").val(),i=$("#skillid option:selected").val(),n=$("#quotabletime").val();if(n==""&&(n=0),t==""||i=="")return sweetAlert("Sorry","Please select project and skill.","error"),!1;$.ajax({url:"/tickets/startworking/",data:{id:r,status:2,project:t,quotedtime:n,skill:i},type:"POST"}).done(function(n){if(n.error)return new PNotify({title:"Error",text:n.errortext,addclass:"stack-bottom-right",type:"error"}),!1;n.success?(new PNotify({title:"Success",text:n.successtext,addclass:"stack-bottom-right",type:"success"}),$(".assignedusersinput").tagsinput("add",{id:n.userid,text:n.username}),$(".newassignedusersinput").tagsinput("add",{id:n.userid,text:n.username})):new PNotify({title:"Info",text:n.successtext,addclass:"stack-bottom-right",type:"info"});jQuery("#startWorkingModal").modal("toggle")})});jQuery(".newassignedusersinput").on("beforeItemAdd",function(n){var t=n.item;$.ajax({url:"/tickets/PrefetchSingleTeams?UserID="+t.value,type:"GET"}).done(function(n){return n.error?(alert(JSON.stringify(n.errortext)),!1):(jQuery(".assignedteaminput").tagsinput("add",{value:n.teamid,text:n.teamName}),!1)})});jQuery("#basic-addon2").click(function(){loadModalData()});jQuery(".assignedusersinput").on("beforeItemAdd",function(n){if(user){tempz=n.item;loadModalData();$(".newassignedusersinput").tagsinput("add",tempz,{preventPost:!0});$("#ticketAssignModal").modal("show");var t=n.item;$.ajax({url:"/tickets/PrefetchSingleTeams?UserID="+t.value,type:"GET"}).done(function(n){return n.error?(alert(JSON.stringify(n.errortext)),!1):(jQuery(".assignedteaminput").tagsinput("add",{value:n.teamid,text:n.teamName}),!1)})}});jQuery(".newassignedusersinput").on("beforeItemRemove",function(n){if(user){user=!1;var t=n.item,i=jQuery("#ticketid").val();n.options&&n.options.preventPost||jQuery.post("/tickets/removeticketuser",{id:i,userid:t.value},function(n){n.success||jQuery(".newassignedusersinput").tagsinput("add",t,{preventPost:!0});n.success&&new PNotify({title:"Success!",text:n.messagetext,addclass:"stack-bottom-right",type:"success"});reloadAssignment()});setTimeout(function(){user=!0},100)}});jQuery(".assignedusersinput").on("beforeItemRemove",function(n){if(user){user=!1;var t=n.item,i=jQuery("#ticketid").val();n.options&&n.options.preventPost||jQuery.post("/tickets/removeticketuser",{id:i,userid:t.value},function(n){n.success||jQuery(".assignedusersinput").tagsinput("add",t,{preventPost:!0});n.success&&new PNotify({title:"Success!",text:n.messagetext,addclass:"stack-bottom-right",type:"success"});reloadAssignment()});setTimeout(function(){user=!0},100)}});jQuery(".assignedteaminput").on("beforeItemRemove",function(n){var t=n.item,i=jQuery("#ticketid").val();n.options&&n.options.preventPost||jQuery.post("/tickets/RemoveTicketteam",{id:i,teamid:t.value},function(n){!n.success;n.success&&new PNotify({title:"Success!",text:n.messagetext,addclass:"stack-bottom-right",type:"success"});reloadAssignment()})});jQuery("#ticketAssignModal").on("hidden.bs.modal",function(){counter=1});jQuery(document).on("click",".assign-single-ticket",function(){var f=jQuery("#ticketid").val(),n=jQuery("#Assignmenttaskproject").val(),t=jQuery("#Assignmenttaskskill").val(),i=jQuery(".newassignedusersinput").val(),r=jQuery(".assignedteaminput").val(),e=jQuery("#ticketcomments").val(),o=jQuery("#StartDate").val(),s=jQuery("#EndDate").val(),h=f,u=jQuery("#estimateTimeInput").val(),c=jQuery("#EstimateTimeHidden").val();if(i==""||i==null||r==""||r==null)return sweetAlert("Sorry","Please select both users and teams from the list.","error"),!1;if(n==""||n==null)return sweetAlert("Sorry","Please select a project from the list.","error"),!1;if(t==""||t==null)return sweetAlert("Sorry","Please select a skill from the list.","error"),!1;if(i==""&&r=="")return sweetAlert("Sorry! Assignment Missing","Please assign ticket to at least one user/team.","error"),!1;u===c&&(u=null);$.ajax({url:"/tickets/assigntickets/",data:{ticketcsv:h,projectid:n,skillid:t,StartDate:o,EndDate:s,usercsv:i,teamcsv:r,comment:e,EstimatedTime:u},type:"POST"}).done(function(i){if(i.error){var r=$("#error-notification-template").html(),u=Handlebars.compile(r),f=u(i);return jQuery("#ticketAssignModal").find(".panel-body").prepend(f),!1}return reloadAssignment(),$("#taskprojectid").val(n),$("#taskprojectid").select2().trigger("change"),$("#taskskillid").val(t),$("#taskskillid").select2().trigger("change"),$("#cskillid").val(t),$("#cprojectid").val(n),new PNotify({title:"Success",text:"The task has been assigned to selected users and teams.",type:"success",addclass:"stack-bottom-right",hide:!0}),jQuery("#ticketAssignModal").modal("hide"),!1})});n=new FormData;t=1;jQuery(document).on("click",".remove-attachment",function(){$(this).closest(".emailattachment").remove();var t=$(this).parent().parent().parent().attr("id");n.delete(t)});jQuery(document).on("click","#btnReply",function(){var t,i,n,r,e,o,u,f;jQuery(".view-email-actions").hide();jQuery(".send-email-actions").show();$("#emailType").val("Reply");t=jQuery("#leftNevMenu").find(".active").data("emailid");jQuery("#ticketdetail").data("ticketitemid",t);i=jQuery("#emailcontentwrapper").find("#email-"+t).find(".from").html().trim();jQuery("#EmailSendTo").tagsinput("add",{value:i,text:i});jQuery("#EmailSendCC").tagsinput("removeAll");n=$(".ticket-title").find("span:first").html().trim();(n.substring(0,3)=="RE:"||n.substring(0,3)=="Re:"||n.substring(0,3)=="Fw:"||n.substring(0,3)=="FW:")&&(n=n.substring(3));r=jQuery("#EmailSendSubject").val("RE:"+n.trim());r.val().toLowerCase().indexOf("[ticket#")==-1&&(e=jQuery(".ticketidonspan").attr("value"),o=jQuery("#EmailSendSubject").val(r.val()));u=jQuery("#UserEmailSignature").val();f=$("#ticketdetail").find(".emailcontainer").find("#email-body").html().trim();CKEDITOR.instances.Emailbody.setData("<br/><br/>"+u+"<hr><br/>"+f);$(".emailcontainer").hide();$("#replayPanel").show();$(".BCC").hide()});jQuery(document).on("click","#btnReplyAll",function(){var i,n,u,h,c,o,s;jQuery(".view-email-actions").hide();jQuery(".send-email-actions").show();$("#emailType").val("ReplyAll");var t=jQuery("#leftNevMenu").find(".active").data("emailid"),r=jQuery("#emailcontentwrapper").find("#email-"+t).find(".from").html().trim(),f=jQuery("#emailcontentwrapper").find("#email-"+t).find(".to-addresses").html().trim().split(";"),e=!1;$.each(f,function(n){var t=f[n].split(",");$.each(t,function(n){r==t[n]&&(e=!0);t[n]!=""&&jQuery("#EmailSendTo").tagsinput("add",{value:t[n],text:t[n]})})});e==!1&&jQuery("#EmailSendTo").tagsinput("add",{value:r,text:r});jQuery("#emailcontentwrapper").find("#email-"+t).find(".cc-addresses").hasClass("has-data")&&(i=jQuery("#emailcontentwrapper").find("#email-"+t).find(".cc-addresses").html().trim().split(";"),$.each(i,function(n){jQuery("#EmailSendCC").tagsinput("add",{value:i[n],text:i[n]})}),jQuery("#EmailSendCC").val(jQuery("#emailcontentwrapper").find("#email-"+t).find(".cc-addresses").html().trim()));jQuery("#EmailSendBCC").val(jQuery("#emailcontentwrapper").find("#email-"+t).find(".bcc-addresses").html().trim());n=$(".ticket-title").find("span:first").html().trim();(n.substr(0,3)=="RE:"||n.substr(0,3)=="Re:"||n.substr(0,3)=="FW:"||n.substr(0,3)=="Fw:")&&(n=n.substring(3));u=jQuery("#EmailSendSubject").val("RE:"+n.trim());u.val().toLowerCase().indexOf("[ticket#")==-1&&(h=jQuery(".ticketidonspan").attr("value"),c=jQuery("#EmailSendSubject").val(u.val()));o=jQuery("#UserEmailSignature").val();s=$("#ticketdetail").find(".emailcontainer").find("#email-body").html().trim();CKEDITOR.instances.Emailbody.setData("<br/>"+o+"<hr><br/>"+s);$(".emailcontainer").hide();$("#replayPanel").show();$(".BCC").hide()});jQuery(document).on("click","#btnForword",function(){var t,f,n,i,e,o,r,u;jQuery(".view-email-actions").hide();jQuery(".send-email-actions").show();$("#emailType").val("Forward");t=jQuery("#leftNevMenu").find(".active").data("emailid");jQuery("#EmailSendTo").val("");jQuery("#EmailSendCC").val("");jQuery("#EmailSendBCC").val("");f=$(".ticket-title").find("span:first").html().trim();n=$(".ticket-title").find("span:first").html().trim();(n.substr(0,3)=="RE:"||n.substr(0,3)=="Re:"||n.substr(0,3)=="FW:"||n.substr(0,3)=="Fw:")&&(n=n.substring(3));i=jQuery("#EmailSendSubject").val("Fw:"+n);i.val().toLowerCase().indexOf("[ticket#")==-1&&(e=jQuery(".ticketidonspan").attr("value"),o=jQuery("#EmailSendSubject").val(i.val()));r=jQuery("#UserEmailSignature").val();u=$("#ticketdetail").find(".emailcontainer").find("#email-body").html().trim();CKEDITOR.instances.Emailbody.setData("<br/>"+u+r);jQuery("#emailcontentwrapper").find("#email-"+t).find(".attachments").hasClass("has-data")?(jQuery(".send-attachments").html("").html("<hr style='margin: 10px 0px;' />").show(),jQuery("#emailcontentwrapper").find("#email-"+t).find(".attachments").find(".attachment-item").each(function(){jQuery(".send-attachments").prepend(jQuery(this).html())})):jQuery(".send-attachments").hide();$(".emailcontainer").hide();$("#replayPanel").show();$(".BCC").hide()});jQuery(document).on("click",".cancelemail",function(){jQuery(".view-email-actions").show();jQuery(".send-email-actions").hide();$("#emailType").val("");$(".emailcontainer").show();$("#replayPanel").hide();isCC=!1;isBCC=!1;$("#UploadAttachmentprogress").html("");$("#EmailSendTo").html("");$("#EmailSendTo").tagsinput("removeAll")});jQuery("#attachNewFiles").change(function(){var r=document.getElementById("attachNewFiles").files,i,u;for(jQuery(".send-attachments").show(),i=0;i<r.length;i++)n.append("file_"+t,r[i],r[i].name),u="<div id='file_"+t+"' class='btn-group emailattachment newfile' style='margin-bottom: 3px;margin-right: 2px;'><a class='btn bg-slate-400'>"+r[i].name+"<\/a> <button type='button' class='btn bg-slate-400 dropdown-toggle' data-toggle='dropdown' aria-expanded='false'><span class='caret'><\/span><\/button><ul class='dropdown-menu dropdown-menu-right'><li><a class='remove-attachment'><i class='icon-close2'><\/i>Remove Attachment<\/a><\/li><\/ul><\/div>",jQuery(".send-attachments").prepend(u),t++});jQuery(document).on("click",".btnSendEmail",function(){var c=jQuery(".timelogWithEmailSending").data("ticketitemid"),l=!1,i,r,u,f,t,h;if($("#tlcheckbox").is(":checked")==!0){l=!0;var a=jQuery("#taskprojectid").val(),v=jQuery("#taskskillid").val(),y=jQuery("#timespentinminutes").val(),p=jQuery("#description").val();if(a<=0)return new PNotify({title:"Error",text:"Please select the project",type:"error",addclass:"stack-bottom-right",hide:!0}),!1;if(v<=0)return new PNotify({title:"Error",text:"Please select the skill",type:"error",addclass:"stack-bottom-right",hide:!0}),!1;if(y==0)return new PNotify({title:"Error",text:"Please enter the time spent",type:"error",addclass:"stack-bottom-right",hide:!0}),!1;if(p=="")return new PNotify({title:"Error",text:"Please enter the task description",type:"error",addclass:"stack-bottom-right",hide:!0}),!1}if(i=$("#EmailSendTo").val().replace(/\;/g,","),r=$("#conversation").val(),i.indexOf(";")>=0)return new PNotify({title:"Invalid Character",text:"Please Remove ; From TO",type:"warning",sticker:!1,addclass:"stack-bottom-right",hide:!1}),!1;if(u=$("#EmailSendCC").val().replace(/\;/g,","),u.indexOf(";")>=0)return new PNotify({title:"Invalid Character",text:"Please Remove ; From CC",type:"warning",sticker:!1,addclass:"stack-bottom-right",hide:!1}),!1;if(f=$("#EmailSendBCC").val().replace(/\;/g,","),f.indexOf(";")>=0)return new PNotify({title:"Invalid Character",text:"Please Remove ; From BCC",type:"warning",sticker:!1,addclass:"stack-bottom-right",hide:!1}),!1;if(c=jQuery("#leftNevMenu").find(".active").data("emailid"),t=$("#EmailSendTo").val(),!t)new PNotify({title:"Requird Info is Missing",text:"Please Enter To Email Address",type:"warning",sticker:!1,addclass:"stack-bottom-right",hide:!1});else{var w=$("#ticketid").val(),b=$("#emailType").val(),e="",o="";o=isCC?$("#EmailSendCC").val().replace(/\;/g,","):"";e=isBCC?$("#EmailSendBCC").val().replace(/\;/g,","):"";var k=$("#EmailSendSubject").val(),d=CKEDITOR.instances.Emailbody.getData(),s="",c=jQuery(".timelogWithEmailSending").data("ticketitemid"),a=jQuery("#taskprojectid").val(),v=jQuery("#taskskillid").val(),nt=jQuery("#workdate").val(),y=jQuery("#timespentinminutes").val(),tt=jQuery("#billabletimeinminutes").val(),g=jQuery(".ticket-title").text().trim(),it=jQuery("#description").val(),rt=jQuery("#WarningStatus").val(),ut=jQuery("#WarningText").val();$(".send-attachments").find(".emailattachment").each(function(n,t){if($(t).hasClass("existingfile")){var i=$(t).attr("id");i=i+"_E";s+=i+","}});h={type:b,TO:t,CC:o,BCC:e,Subject:k,body:d,TicketID:w,Attach:s,TicketTitle:g,MessageId:r};n.append("data",JSON.stringify(h));swal({title:"Email sending...",text:"Please wait",buttons:!1,showCancelButton:!1,showConfirmButton:!1,closeOnClickOutside:!1,closeOnEsc:!1});$.ajax({url:"/GraphMails/SendMail/",processData:!1,contentType:!1,data:n,type:"POST"}).done(function(n){if(swal.close(),n.error)return new PNotify({title:"Error",text:n.response,type:"warning",addclass:"stack-bottom-right",hide:!1}),!1;$(".btncancelreplay").click();new PNotify({title:"Success",text:n.response,type:"success",sticker:!1,addclass:"stack-bottom-right",hide:!1});jQuery(".view-email-actions").show();jQuery(".send-email-actions").hide();jQuery(".emailcontainer").show();jQuery(".sendemailcontainer").hide()})}});$(".emailcontainer").find("a").each(function(){var n=$(this).attr("href");$(this).attr("href","https://google.com/url?q="+n)});$(".mail-attachments").find("a").each(function(){var n=$(this).attr("href");$(this).attr("href",n.substring(25,n.length))});$(document).on("click",".DeleteComments",function(){var n=$(this).data("id"),t=$(this);confirm("Are you shur you want to delete this")&&$.ajax({url:"/Tickets/DeleteCommentById/",data:{id:n},type:"POST"}).done(function(n){if(n=="Deleted"){$(t).parent().parent().parent().remove();var i=parseInt($(".commentbody").first("li .media-body").html().length);i==0&&$(".commentbody").append($.parseHTML("<strong class='Norecordfound'>No record found<\/strong>"))}else alert("Failed")})});$(document).on("click",".EditComments",function(){EditObj=$(this);EditCommentID=$(this).data("id");var n=$(this).parent().parent().parent().find("#CommentBody").html();CKEDITOR.instances.txtComments.setData(n);$("#btnAddComments").hide();$("#btnSaveComments").show();$("#btnCancelComments").show();i()});$(document).on("click","#btnSaveComments",function(){var n=CKEDITOR.instances.txtComments.getData();n.length>0&&$.ajax({url:"/Tickets/EditCommentById",data:{comments:n,Id:EditCommentID},type:"POST"}).done(function(t){return t.error?(alert("Failed"),!1):(t=="Success"?($(EditObj).parent().parent().parent().find("#CommentBody").html(n),CKEDITOR.instances.txtComments.setData(""),$("#btnAddComments").show(),$("#btnSaveComments").hide(),$("#btnCancelComments").hide()):alert("Failed"),!1)})});$(document).on("click","#btnCancelComments",function(){$("#btnAddComments").show();$("#btnSaveComments").hide();$("#btnCancelComments").hide();CKEDITOR.instances.txtComments.setData("")});jQuery(function(){});jQuery(document).on("click","#btnAddComments",function(){var n=CKEDITOR.instances.txtComments.getData(),t=$("#ticketid").val();n.length>0&&$.ajax({url:"/Tickets/AddCommentByTicketId",data:{comments:n,ticketId:$("#ticketid").val()},type:"POST"}).done(function(n){if(n.error)return alert("Failed"),!1;var u=$.datepicker.formatDate("mm/dd/yy",new Date(Date(n.commenton))),r="<li class='media'><div class='media-left'><a href='#'>";return r+=n.ProfileImage!=undefined?"<img id='id"+n.id+"' src='/Content/images/"+n.ProfileImage+"' class='img-circle img-sm' alt='Not Loaded'>":"<img id='id"+n.id+"' src='/Content/images/placeholder.jpg' class='img-circle img-sm' alt='Not Loaded'>",r+="<\/a><\/div><div class='media-body'><div class='media-heading'><a href='#' class='text-semibold'> "+n.commentbyusername+"<\/a><span class='media-annotation dotted'>"+u+"<\/span><\/div>",r+="<div id='CommentBody'>"+n.commentbody+"<\/div><br/>",r+="<ul class='list-inline list-inline-separate text-size-small'>",r+="<li class='EditComments' data-id='"+n.id+"'><a>Edit<\/a><\/li><li class='DeleteComments' data-id='"+n.id+"'><a >Delete<\/a><\/li><\/ul><\/div>",r+="<div class='media-right'><i data-ticketid='"+t+"' data-commentid='"+n.id+"' class='fa fa-clipboard comment-link'><\/i><\/div><\/li>",$(".commentbody").prepend($.parseHTML(r)),CKEDITOR.instances.txtComments.setData(""),$(".Norecordfound").remove(),i(),!1})});jQuery(document).on("click",".changeticketstatus",function(){var t=$(this),n=jQuery(this).data("statusid"),i=jQuery("#ticketid").val();return $(".usernotification").remove(),$.ajax({url:"/tickets/chnageticketstatus/",data:{id:i,status:n},type:"POST"}).done(function(i){var r,u;if(i.error){var f=$("#error-notification-template").html(),e=Handlebars.compile(f),o=e(i);return $(".usernotification").prepend(o),!1}$(t).remove();r="";n<=2||n==5?(r+="<button type='button' class='btn btn-xs bg-danger-700 changeticketstatus' data-statusid='3'>Close<\/button>",r+="<button type='button' class='btn btn-xs bg-danger-700 dropdown-toggle' data-toggle='dropdown'>",r+="<span class='caret'><\/span>",r+="<\/button>"):(r+="<button type='button' class='btn btn-xs bg-success-700 changeticketstatus' data-statusid='2'>Open<\/button>",r+="<button type='button' class='btn btn-xs bg-success-700 dropdown-toggle' data-toggle='dropdown'>",r+="<span class='caret'><\/span>",r+="<\/button>");r+="<ul class='dropdown-menu' role='menu' style='left:-90px;'>";n<=3&&(r+="<li class='changeticketstatus' data-statusid='5'><a href='#'>Review<\/a><\/li>");n<=2&&(r+="<li class='changeticketstatus' data-statusid='4'><a href='#'>Wont Fix<\/a><\/li>");r+="<\/ul>";$("#StatusDropdown").html(r);n==1?u="New Task":n==2?u="In Progress":n==3?u="Done":n==4?u="On Hold":n==5?u="QC":n==6?u="Assigned":n==7?u="In Review":n==8&&(u="Trash");$("#statuschangedValuedAjax").html(u);$(".sidebarticketstatus").html(u);new PNotify({title:"Success!",text:"Successfully status updated to "+u,addclass:"stack-bottom-right",type:"success"})}),!1});$(document).on("click",".add-new-skill",function(){$("#skillname").val("");$("#AddSkillModal").modal("toggle")});$(document).on("click",".add-credential",function(){$("#crendentialtypeid").select2().val("2").trigger("change");$("#credentiallevelid").select2().val("4").trigger("change");$("#credentialcategoryid").select2().val("9").trigger("change");$("#AddCredentialModal").modal("toggle")});$("#AddProjectModal").on("hidden.bs.modal",function(){$(this).find("#projectname").val("");$(this).find("textarea,select").val("").end()});$(document).on("click",".add-new-project",function(){jQuery("#clientid").select2();$("#AddProjectModal").modal("toggle")});$(document).on("click",".save-credential",function(){var l=$("#credentialcategoryid option:selected").text(),a=$("#taskprojectid option:selected").text(),h=$("#ctitle").val(),f=$("#url").val(),t=$("#username").val(),i=$("#password").val(),e=$("#credentialcategoryid").val(),o=$("#crendentialtypeid").val(),r=$("#credentiallevelid").val(),u=$("#host").val(),n=$("#port").val(),c=$("#ccomment").val(),s=$("#cprojectid").val(),v=$("#cskillid").val();if(e==null||e=="")return new PNotify({title:"Error!",text:"Please select credential category!",addclass:"stack-bottom-right",type:"error"}),!1;if(o==null||o=="")return new PNotify({title:"Error!",text:"Please select credential type!",addclass:"stack-bottom-right",type:"error"}),!1;if(r==null||r=="")return new PNotify({title:"Error!",text:"Please select credential Level!",addclass:"stack-bottom-right",type:"error"}),!1;if(s==null||s=="")return new PNotify({title:"Error!",text:"Project not selected",addclass:"stack-bottom-right",type:"error"}),!1;if(t==null||t=="")return new PNotify({title:"Error!",text:"Please add username",addclass:"stack-bottom-right",type:"error"}),!1;if(i==null||i=="")return new PNotify({title:"Error!",text:"Please add password",addclass:"stack-bottom-right",type:"error"}),!1;$.ajax({url:"/tickets/CreateCredential/",data:{url:f,username:t,password:i,projectid:s,catogeryid:e,typeid:o,levelid:r,skillid:v,title:h,host:u,port:n,comments:c},type:"POST"}).done(function(e){if(e.error)return alert(e.msg),!1;var o="<tr><td colspan='4'>";return(n!=null||n!="")&&(o+="<span class='credential_title'>"+h+"<\/span><br />"),o+="<a target='_blank' href="+f+">"+f+"<\/a><br /><span class='label bg-grey-400'>"+r+"<\/span><span class='label bg-success-400'>"+l+"<\/span>",(n!=null||n!="")&&(o+="<span class='label bg-indigo-400'>Port:"+n+"<\/span>"),(u!=null||u!="")&&(o+="<span class='label bg-indigo-400'>Host/IP:"+u+"<\/span>"),o+="<span class='text-semibold label bg-blue-400'>"+a+"<\/span><\/td><td><span class='text-semibold usernameval'>"+t+"<\/span><a href = '#' class='usernameclick' style='color:green;'>&nbsp; &nbsp;<i class='fa fa-clipboard' title='Copy to Clipboard'><\/i><\/a><br /><span class='text-muted passwordval'>"+i+"<\/span><a href = '#' class='pwdclick' style='color:green;'>&nbsp; &nbsp;<i class='fa fa-clipboard' title='Copy to Clipboard'><\/i><\/a> <\/td><td>"+c+"<\/td><td><a class='btn btn-primary btn-xs editcredentialsbtn' href='/credentials/Edit/"+e.id+"' data-id="+e.id+" style='color: white'>Edit<\/a><\/td>><\/tr>",$(".cTableList").append(o),$("#AddCredentialModal").modal("hide"),!1})});jQuery(document).on("click",".add-project",function(){var n=$("#clientid").val(),t=$("#projectname").val();if(n==null||n=="")return sweetAlert("Sorry","Please select a client from the list.","error"),!1;if(t==null||t=="")return sweetAlert("Sorry","Please add the project name.","error"),!1;$.ajax({url:"/home/AddProject/",data:{clientid:n,projectname:t},type:"POST"}).done(function(n){if(n.error)return alert(n.message),!1;$("#Assignmenttaskproject").append($("<option>",{value:n.prid,text:n.prname}));jQuery("#AddProjectModal").modal("hide")})});jQuery(document).on("click",".add-skill",function(){var n=$("#skillname").val();if(n==""||n==null)return sweetAlert("Sorry","Please add the skill name.","error"),!1;$.ajax({url:"/home/AddSkill/",data:{name:n},type:"POST"}).done(function(n){if(n.error)return alert(n.message),!1;$("#Assignmenttaskskill").append($("<option>",{value:n.skid,text:n.skname}));jQuery("#AddSkillModal").modal("hide")})});$(document).on("click",".changer",function(){$(".task-project-link").addClass("hidden");$(".task-project-dropdown").removeClass("hidden")});$(document).on("click",".cross",function(){$(".task-project-link").removeClass("hidden");$(".task-project-dropdown").addClass("hidden")});jQuery(document).on("click",".comment-link",function(){var t=$(this).data("ticketid"),i=$(this).data("commentid"),r="https://"+window.location.host+"/tickets/comment/"+t+"/"+i,n=$("<input>");return $("body").append(n),n.val(r.trim()).select(),document.execCommand("copy"),n.remove(),new PNotify({title:"Success!",text:"Successfully copied comment link",addclass:"stack-bottom-right",type:"success"}),!1})});