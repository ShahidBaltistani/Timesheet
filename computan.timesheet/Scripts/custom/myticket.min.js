function loadProducts(n){var t=jQuery(".filterbystatus").find(".active").prop("id"),i=jQuery(".filterbyclient").find(".active").data("clientid"),r=$("#searchvalue").val();return $.post("/tickets/mytickets/",{id:t,clientid:i,pagenum:n,topic:r},function(n){return jQuery("#loadmoretr").remove(),$("#ticketscontainer").append(n.ticketitems),!1}),!1}function updateglobalbuckets(){$.ajax({url:"/GlobalBuckets/index/",data:"",type:"GET"}).done(function(n){n.error;$(".GlobalBucketslist").html(n);var t=$("div.bucketitemrow");t=t.length;$(".bucktcount").html(t)})}function getFormattedDate(n){return("0"+(n.getMonth()+1)).slice(-2)+"/"+("0"+n.getDate()).slice(-2)+"/"+n.getFullYear()}jQuery(function(){var t=$(".selecttask"),n=null;t.click(function(i){if(!n){n=this;return}if(i.shiftKey){var r=t.index(this),u=t.index(n);t.slice(Math.min(r,u),Math.max(r,u)+1).prop("checked",n.checked)}n=this});jQuery(document).on("click",".mytaskstatuslink",function(){var n=$(this).attr("data-id"),r=$("#searchvalue").val(),i=0,t;return($("#currentStatusId").val(n),$("#pagenumber").val(i),$(".clientli").each(function(){$(this).removeClass("active")}),$(".clientli#client-0").addClass("active"),$.post("/tickets/mytickets/",{id:n,clientid:0,pagenum:i,topic:r},function(t){return t.itemcount!=0?$("#ticketscontainer").html(t.ticketitems):$("#ticketscontainer").html('<tr><td colspan="2" class="text-center">Sorry, No more task found.<\/td><\/tr>'),$(".statusli").each(function(){$(this).removeClass("active")}),$(".statusli#"+n).addClass("active"),$("#searchtext").val(""),!1}),typeof history.pushState=="undefined")?(alert("Browser does not support HTML5."),!1):(t={Title:"new",Url:"/tickets/mytickets/"+n},history.pushState(t,t.Title,t.Url),!1)});jQuery(".filterclients").livefilter({selector:".clientcollection li"});jQuery("#searchtext").livefilter({selector:"#ticketscontainer tr"});jQuery(document).on("click",".myclientlink",function(){var i=$("#currentStatusId").val(),n=$(this).attr("data-clientid"),u=$("#searchvalue").val(),r=0,t;return($("#currentClientId").val(n),$("#pagenumber").val(r),$.post("/tickets/mytickets/",{id:i,clientid:n,pagenum:r,topic:u},function(t){return t.itemcount!=0?$("#ticketscontainer").html(t.ticketitems):$("#ticketscontainer").html('<tr><td colspan="2" class="text-center">Sorry, No more task found.<\/td><\/tr>'),$(".clientli").each(function(){$(this).removeClass("active")}),$(".clientli#client-"+n).addClass("active"),!1}),typeof history.pushState=="undefined")?(alert("Browser does not support HTML5."),!1):(t={Title:"new",Url:"/tickets/mytickets/"+i+"/"+n},history.pushState(t,t.Title,t.Url),!1)});jQuery(document).on("click",".addfavclient",function(){var n=jQuery(this),t=jQuery(this).siblings("section").data("clientid");return $.post("/tickets/addfavouriteclient/",{id:t},function(t){t.success==1&&jQuery(n).removeClass("fa-star-o").removeClass("addfavclient").addClass("fa-star").addClass("removefavclient")}),!1});jQuery(document).on("click",".removefavclient",function(){var n=jQuery(this),t=jQuery(this).data("userfavid");return $.post("/tickets/removefavouriteclient/",{id:t},function(t){t.success==1&&jQuery(n).removeClass("fa-star").removeClass("removefavclient").addClass("fa-star-o").addClass("addfavclient")}),!1});jQuery(document).on("click",".checkall",function(){var n=this.checked;jQuery("#ticketscontainer").find("tr").each(function(){jQuery(this).hasClass("lf-hidden")||jQuery(this).find(".selecttask:checkbox").prop("checked",n)})});jQuery(document).on("click",".selecttask",function(){this.checked?$(".selecttask").length==$(".selecttask:checked").length&&$(".checkall").prop("checked",!0):$(".checkall").prop("checked",!1)});jQuery(document).on("click",".addtobucket",function(){$("#mybucketmodal").find(".panel-title").html("Add Ticket to Bucket");$("#taskbucketdate").datepicker({dateFormat:"mm/dd/yy"});$("#taskbucketdate").val(getFormattedDate(new Date));$("#taskbucketdate").attr("data-tid",$(this).closest("tr").prop("id"));$("#btnsavetobucket").removeClass("savemultibucket").addClass("savesinglebucket");$("#mybucketmodal").modal("toggle")});jQuery(document).on("click",".AddTimeLog",function(){$(".ticket-title").html($(this).parent().find("a").html());var n=$(this).closest("tr").prop("id");$("#timespentinminutes").val("0");$("#billabletimeinminutes").val("0");$("#description").val("The task has been updated/completed.");$("#workdate").datepicker({dateFormat:"mm/dd/yy",maxDate:0});$("#workdate").val(getFormattedDate(new Date));$.ajax({url:"/tickets/TicketAllocation?id="+n,data:{},type:"GET"}).done(function(n){if(n.error)return!1;$("#AddTimeLogModel").modal("toggle");$("#ticketItemID").val(n.ticketItemID);$("#ProjectID").val(n.projectid);$("#Project").val(n.projectname);$("#SkillID").val(n.skillid);$("#Skill").val(n.skillname);$("#WarningStatus").val(n.WarningStatus);$("#WarningText").val(n.Warningtext)})});jQuery("#timespentinminutes").on("input",function(){jQuery("#billabletimeinminutes").val(jQuery(this).val())});jQuery("#description").on("focus",function(){jQuery(this).select()});jQuery(document).on("click",".savetimeTicket",function(){var r=jQuery("#ticketItemID").val(),u=jQuery("#ProjectID").val(),f=jQuery("#SkillID").val(),t=jQuery("#workdate").val(),n=jQuery("#timespentinminutes").val(),e=jQuery("#billabletimeinminutes").val(),o=encodeURI(jQuery(".ticket-title").text().trim()),i=jQuery("#description").val(),s=jQuery("#WarningStatus").val(),h=jQuery("#WarningText").val();return t==""?(new PNotify({title:"Work Date Required",text:"Please select a work date.",type:"error",hide:!1}),!1):n==""||n=="0"?(new PNotify({title:"Time Spent",text:"Please enter a valid time spent.",type:"error",hide:!1}),!1):i==""?(new PNotify({title:"Description Required",text:"Please enter description.",type:"error",hide:!1}),!1):($.ajax({url:"/tickets/addtime/",data:{tcktitemid:r,pid:u,sid:f,spenttime:n,billtime:e,workdate:t,title:o,description:i,comments:""},type:"POST"}).done(function(n){return n.error?(new PNotify({title:"Error",text:n.errortext,type:"error",hide:!0}),!1):(new PNotify({title:"Success",text:"Time has been added successfully.",type:"success",hide:!0}),$("#AddTimeLogModel").modal("toggle"),!1)}),s&&new PNotify({title:"<h1>Warning!<\/h1>",text:"<h3>"+h+"<\/h3>",type:"error",hide:!1}),!1)});jQuery(document).on("click",".addmultibucket",function(){return $(".selecttask:checked").length==0?(new PNotify({title:"Warning!",text:"Please select at least one ticket to add in the bucket!",type:"warning"}),!1):($("#mybucketmodal").find(".panel-title").html("Add Multiple Tickets to Bucket"),$("#taskbucketdate").datepicker({dateFormat:"mm/dd/yy"}),$("#taskbucketdate").val(getFormattedDate(new Date)),$("#btnsavetobucket").removeClass("savesinglebucket").addClass("savemultibucket"),$("#mybucketmodal").modal("toggle"),!1)});jQuery(document).on("click",".savesinglebucket",function(){var t=$("#taskbucketdate").val(),i,n;return t==""?(new PNotify({title:"Sorry!",text:"The date is required to add ticket to the bucket.",type:"error"}),!1):(i=$("#taskbucketdate").data("tid"),n=[],n.push(i),$.ajax({url:"/TicketTimeLogs/SaveMultipleBuckets/",data:{bucketdate:t,ticketlist:n},type:"POST"}).done(function(n){if(n.error){var t=$("#error-notification-template").html(),i=Handlebars.compile(t),r=i(n);return $("#modelassignuseradmindiv").prepend(r),!1}return updateglobalbuckets(),new PNotify({title:"Success",text:n.Successtext,type:"success"}),!1}),$("#mybucketmodal").modal("toggle"),!1)});jQuery(document).on("click",".savemultibucket",function(){var t=$("#taskbucketdate").val(),n;return t==""?(new PNotify({title:"Sorry!",text:"The date is required to add ticket to the bucket.",type:"error"}),!1):(n=[],$(".selecttask:checked").each(function(){n.push($(this).val())}),$.ajax({url:"/TicketTimeLogs/SaveMultipleBuckets/",data:{bucketdate:t,ticketlist:n},type:"POST"}).done(function(n){if(n.error){var t=$("#error-notification-template").html(),i=Handlebars.compile(t),r=i(n);return $("#modelassignuseradmindiv").prepend(r),!1}return updateglobalbuckets(),$(".selecttask:checked").prop("checked",!1),$(".checkall").prop("checked",!1),new PNotify({title:"Success",text:n.Successtext,type:"success"}),!1}),$("#mybucketmodal").modal("toggle"),!1)});jQuery(document).on("mouseover",".changeticketstatus",function(){jQuery(this).closest("tr").find(".hideable").show()});jQuery(document).on("click",".changeticketstatus",function(){var n=jQuery(this).data("statusid"),t=jQuery(this).closest("tr").prop("id");return $(".usernotification").remove(),$.ajax({url:"/tickets/chnageticketstatus/",data:{id:t,status:n},type:"POST"}).done(function(i){var r,f,u,e;if(i.error){var o=$("#error-notification-template").html(),s=Handlebars.compile(o),h=s(i);return $("#maincontent").prepend(h),!1}r=$("#"+n+".my_task_status").text();r=parseInt(r);r=r+1;$("#"+n+".my_task_status").text(r);f=$(".filterbystatus").find(".active").prop("id");u=$("#"+f+".my_task_status").text();u=parseInt(u);u=u-1;$("#"+f+".my_task_status").text(u);e=$("tr#"+t);e.animate({backgroundColor:"yellow"},1e3).fadeOut(1e3,function(){e.remove()})}),!1});jQuery(document).on("click",".openmultistatusmodal",function(){return $(".selecttask:checked").length==0?(new PNotify({title:"Warning!",text:"Please select at least one ticket to change status",type:"warning"}),!1):($("#myticketstatusmodal").modal("toggle"),!1)});jQuery(document).on("click",".changemultipleticketstatus",function(){var n=$(this).data("statusid"),t=[];return $(".selecttask:checked").each(function(){t.push($(this).val())}),$.ajax({url:"/tickets/Closemultiplestatus/",data:{statustype:1,statusid:n,ticketitems:t},type:"POST"}).done(function(i){if(i.error){var r=$("#error-notification-template").html(),u=Handlebars.compile(r),f=u(i);return $("#myticketstatusmodal").prepend(f),!1}return $.each(t,function(t,i){var e=$("tr#"+i),r,f,u;e.animate({backgroundColor:"yellow"},1e3).fadeOut(1e3,function(){e.remove()});r=$("#"+n+".my_task_status").text();r=parseInt(r);r=r+1;$("#"+n+".my_task_status").text(r);f=$(".filterbystatus").find(".active").prop("id");u=$("#"+f+".my_task_status").text();u=parseInt(u);u=u-1;$("#"+f+".my_task_status").text(u)}),new PNotify({title:"Success",text:i.successtext,type:"success"}),!1}),$(".checkall").prop("checked",!1),$("#myticketstatusmodal").modal("toggle"),!1});jQuery(window).scroll(function(){if(jQuery(window).scrollTop()==jQuery(document).height()-jQuery(window).height()){var n=jQuery(".loadmoretickets").closest("tr").length;n>0}});jQuery(document).on("click",".loadmoretickets",function(){var n=parseInt(jQuery(this).data("pagenumber"));n++;loadProducts(n)})});