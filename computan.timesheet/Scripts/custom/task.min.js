jQuery(function(){function e(n,t,i){$(".usernotification").remove();$.ajax({url:"/tickets/chnageticketstatus/",data:{id:n,status:i},type:"POST"}).done(function(n){var f,r,u,e;if(n.error){var o=$("#error-notification-template").html(),s=Handlebars.compile(o),h=s(n);return $("#maincontent").prepend(h),!1}i==3&&(i=5);i==4&&(i=8);f=$("#currentstatusid").val();r=$("#"+i+".my_task_status").text();r=parseInt(r);r=r+1;$("#"+i+".my_task_status").text(r);u=$("#"+f+".my_task_status").text();u=parseInt(u);u=u-1;$("#"+f+".my_task_status").text(u);var o=$("#success-notification-template").html(),s=Handlebars.compile(o),h=s(n);$("#maincontent").prepend(h);e=$("tr#"+t);e.animate({backgroundColor:"yellow"},1e3).fadeOut(1e3,function(){e.remove()})})}function o(n,t){$(".usernotification").remove();$.ajax({url:"/ticketitems/changeemailstatus/",data:{id:n,status:t,quotedtime:0},type:"POST"}).done(function(i){var f,r,u,e;if(i.error)return new PNotify({title:"Error",text:i.error,type:"error"}),!1;f=$("#currentstatusid").val();r=$("#"+t+".my_task_status").text();r=parseInt(r);r=r+1;$("#"+t+".my_task_status").text(r);u=$("#"+f+".my_task_status").text();u=parseInt(u);u=u-1;$("#"+f+".my_task_status").text(u);new PNotify({title:"Success",text:"This ticket status has been updated.",type:"success"});e=$("tr#"+n);e.animate({backgroundColor:"yellow"},1e3).fadeOut(1e3,function(){e.remove()})})}function s(n,t){$(".usernotification").remove();$.ajax({url:"/ticketitems/changeuserstatus/",data:{ticketitemid:n,statusid:t},type:"POST"}).done(function(i){var f,r,u,e;if(i.error)return new PNotify({title:"Error",text:i.error,type:"error"}),!1;f=$("#currentstatusid").val();r=$("#"+t+".my_task_status").text();r=parseInt(r);r=r+1;$("#"+t+".my_task_status").text(r);u=$("#"+f+".my_task_status").text();u=parseInt(u);u=u-1;$("#"+f+".my_task_status").text(u);new PNotify({title:"Success",text:"Your task status has been updated.",type:"success"});e=$("tr#"+n);e.animate({backgroundColor:"yellow"},1e3).fadeOut(1e3,function(){e.remove()})})}function u(n){return("0"+(n.getMonth()+1)).slice(-2)+"/"+("0"+n.getDate()).slice(-2)+"/"+n.getFullYear()}function f(){$.ajax({url:"/GlobalBuckets/index/",data:"",type:"GET"}).done(function(n){n.error;$(".GlobalBucketslist").html(n);var t=$("div.bucketitemrow");t=t.length;$(".bucktcount").html(t)})}jQuery(".filterclients").livefilter({selector:".clientcollection li"});jQuery(document).on("click","#btnsearch",function(){var t=$(this).attr("data-statusid"),n=$("#searchtext").val();return $("#searchvalue").val(n),$("#pagenumber").val(0),$.ajax({url:"/ticketitems/Searchtask",data:{searchstring:n,statusid:t,pagenum:0},type:"GET"}).done(function(i){$("#mytaskrow").html(i.tasks);var r=$("#mytaskrow").find("tr").length;return $("#"+t+".my_task_status").html(i.totalcount),$(".presearchstring").removeClass("hidden"),$(".checkall").prop("checked",!1),n?($(".searchstring").html(" <b>' "+n+" '<\/b>"),$("#searchtext").val("")):$(".presearchstring").addClass("hidden"),!1}),!1});$(document).on("click",".clearsearch",function(){if($("#searchvalue").val()!=""){var n=$("#currentStatusId").val();$("#searchtext").val("");$(".searchstring").html("");$("#searchvalue").val("");$(".checkall").prop("checked",!1);$(".presearchstring").addClass("hidden");$("#pagenumber").val(0);$("#"+n+".mytaskstatuslink").click()}return!1});jQuery(document).on("click",".checkall",function(){jQuery(".selecttask").prop("checked",this.checked)});jQuery(document).on("click",".selecttask",function(){this.checked?$(".selecttask").length==$(".selecttask:checked").length&&$(".checkall").prop("checked",!0):$(".checkall").prop("checked",!1)});jQuery(document).on("click",".addmultibucket",function(){if($(".currentdate").hide(),$(".selecttask:checked").length==0)return new PNotify({title:"Warning!",text:"Please select at least one ticket to add in the bucket!",type:"warning"}),!1;var n=new Date;return $("#bucketkdate").val(u(n)),$("#btnaddtobucket").removeClass("savesinglebucket").addClass("savemultibucket"),$("#addbucketmodel").modal("toggle"),!1});jQuery(document).on("click",".savemultibucket",function(){var t=$("#bucketkdate").val(),n;return t==""?(new PNotify({title:"Error!",text:"Please select a date to add tickets to the bucket.",type:"error"}),!1):(n=[],$(".selecttask:checked").each(function(){n.push($(this).val())}),$.ajax({url:"/TicketTimeLogs/SaveMultipleBuckets/",data:{bucketdate:t,ticketlist:n},type:"POST"}).done(function(n){if(n.error){var t=$("#error-notification-template").html(),i=Handlebars.compile(t),r=i(n);return $("#modelassignuseradmindiv").prepend(r),!1}return f(),$(".selecttask:checked").prop("checked",!1),$(".checkall").prop("checked",!1),new PNotify({title:"Success",text:n.Successtext,type:"success"}),!1}),$("#addbucketmodel").modal("toggle"),!1)});var n,t,i,r;$(document).on("click",".currentdate",function(){var n=new Date;n=u(n);$("#bucketkdate").val(n);$("#bucketkdate_withproid").val(n)});$(document).on("click",".addbucketktime",function(){var f,e;$(".currentdate").show();n=$(this).data("projectid");t=$(this).data("skillid");r=$(this).data("itemid");i=$(this).data("title");f=$(this).data("selecteddate");f=new Date(f);e=u(f);$("#bucketkdate").val(e);$("#bucketkdate_withproid").val(e);n==""||t==""?$("#addbucketmodelwithprojectid").modal("show"):($("#btnaddtobucket").removeClass("savemultibucket").addClass("savesinglebucket"),$("#addbucketmodel").modal("show"))});$(document).on("click",".savesinglebucket",function(){var u=$("#bucketkdate").val();if(u=="")return sweetAlert("Sorry...","All fields having * are Required.","error"),!1;$.ajax({url:"/TicketTimeLogs/addtime/",data:{tcktitemid:r,pid:n,sid:t,spenttime:0,billtime:0,workdate:u,title:i,description:"",comments:""},type:"POST"}).done(function(n){if(n.error){var t=$("#error-notification-template").html(),i=Handlebars.compile(t),r=i(n);return $("#modeladdtimebodydiv").prepend(r),!1}return f(),new PNotify({title:"Success",text:"Time has been added successfully.",type:"success"}),$("#btnaddtobucket").removeClass("savemultibucket").addClass("savesinglebucket"),$("#addbucketmodel").modal("toggle"),!1})});$(document).on("click",".addbucketwithproidpopupbtn",function(){n=$("#projectid_addbucket").val();t=$("#skillid_addbicket").val();var u=$("#bucketkdate_withproid").val();if(u==""||n==""||t=="")return sweetAlert("Sorry...","All fields having * are Required.","error"),!1;$.ajax({url:"/TicketTimeLogs/addtime/",data:{tcktitemid:r,pid:n,sid:t,spenttime:0,billtime:0,workdate:u,title:i,description:"",comments:""},type:"POST"}).done(function(n){if(n.error){var t=$("#error-notification-template").html(),i=Handlebars.compile(t),r=i(n);return $("#modeladdtimebodydiv").prepend(r),!1}return new PNotify({title:"Success",text:"Time has been added successfully.",type:"success"}),f(),$("#addbucketmodelwithprojectid").modal("toggle"),!1})});jQuery("input[name='statustyperadio']").change(function(){$(this).val()=="ticket"?jQuery(this).closest(".row").find(".ticketstatusaction").html(jQuery("#ticketstatuses").html()):jQuery(this).closest(".row").find(".ticketstatusaction").html(jQuery("#ticketitemstatuses").html())});jQuery(document).on("click",".changeticketstatus",function(){var n=jQuery(this).closest(".row").find(".ticketstatusbar").find(".active").find("input[name='statustyperadio']"),t=jQuery(this).data("statusid"),r=jQuery(n).data("ticketid"),i=jQuery(n).data("ticketitemid"),u=jQuery(n).val();switch(u){case"ticket":e(r,i,t);break;case"email":o(i,t);break;case"user":s(i,t)}return!1});jQuery(document).on("click",".closeemultitask",function(){return $(".selecttask:checked").length==0?(new PNotify({title:"Warning!",text:"Please select at least one task to close",type:"warning"}),!1):($("#changemultiplestatusmodel").modal("toggle"),!1)});jQuery(document).on("click",".btnclosemultipletask",function(){var i=$("#statustype").val(),n,t;return i==""?(alert("please select status type"),!1):(n=$("#statusid").val(),n=="")?(alert("please select status"),!1):(t=[],$(".selecttask:checked").each(function(){t.push($(this).val())}),$.ajax({url:"/ticketitems/Closemultiplestatus/",data:{statustype:i,statusid:n,ticketitems:t},type:"POST"}).done(function(n){if(n.error){var t=$("#error-notification-template").html(),i=Handlebars.compile(t),r=i(n);return $("#modelassignuseradmindiv").prepend(r),!1}return new PNotify({title:"Success",text:n.successtext,type:"success"}),!1}),$.each(t,function(t,i){var e=$("tr#"+i),f,r,u;e.animate({backgroundColor:"yellow"},1e3).fadeOut(1e3,function(){e.remove()});f=$("#currentstatusid").val();r=$("#"+n+".my_task_status").text();r=parseInt(r);r=r+1;$("#"+n+".my_task_status").text(r);u=$("#"+f+".my_task_status").text();u=parseInt(u);u=u-1;$("#"+f+".my_task_status").text(u)}),$(".checkall").prop("checked",!1),$("#changemultiplestatusmodel").modal("toggle"),!1)});$(document).on("click",".mytaskstatuslink",function(){var n=$(this).attr("data-id"),r=$("#searchvalue").val(),i=0,t;return($("#currentStatusId").val(n),$("#pagenumber").val(i),$(".clientli").each(function(){$(this).removeClass("active")}),$(".clientli#client-0").addClass("active"),$.post("/ticketitems/mytaskajax/",{id:n,pagenum:i,topic:r},function(t){var i;return t.itemcount!=0?($("#mytaskrow").html(t.ticketitems),$("#btnsearch").attr("data-statusid",n),$(".collapse").collapse(),$(".statusli").each(function(){$(this).removeClass("active")}),$(".my_task_status").each(function(){$(this).removeClass("badge-success");$(this).addClass("badge-default")}),$(".statusli#"+n).addClass("active"),$("#"+n+".my_task_status").removeClass("badge-default"),$("#"+n+".my_task_status").addClass("badge-success"),i=$("#mytaskrow").find("tr").length,$("#"+n+".my_task_status").html(t.totalcount),!1):($("#mytaskrow").html('<tr><td colspan="2" class="text-center">Sorry, No more task found.<\/td><\/tr>'),$("#btnsearch").attr("data-statusid",n),$(".statusli").each(function(){$(this).removeClass("active")}),$(".my_task_status").each(function(){$(this).removeClass("badge-success");$(this).addClass("badge-default")}),$(".statusli#"+n).addClass("active"),$("#"+n+".my_task_status").removeClass("badge-default"),$("#"+n+".my_task_status").addClass("badge-success"),i=$("#mytaskrow").find("tr").length,$("#"+n+".my_task_status").html(t.totalcount),!1)}),typeof history.pushState=="undefined")?(alert("Browser does not support HTML5."),!1):(t={Title:"new",Url:"/ticketitems/mytasks/"+n},history.pushState(t,t.Title,t.Url),!1)});jQuery(document).on("click",".myclientlink",function(){var t=$("#currentStatusId").val(),n=$(this).attr("data-clientid"),u=$("#searchvalue").val(),r=0,i;return($("#currentClientId").val(n),$("#pagenumber").val(r),$.post("/ticketitems/mytasksasync/",{id:t,clientid:n,pagenum:r,topic:u},function(i){return i.itemcount!=0?($("#mytaskrow").html(i.ticketitems),$("#btnsearch").attr("data-statusid",t),$(".collapse").collapse(),$(".clientli").each(function(){$(this).removeClass("active")}),$(".clientli#client-"+n).addClass("active"),!1):($("#mytaskrow").html('<tr><td colspan="2" class="text-center">Sorry, No more task found.<\/td><\/tr>'),$("#btnsearch").attr("data-statusid",t),$(".clientli").each(function(){$(this).removeClass("active")}),$(".clientli#client-"+n).addClass("active"),!1)}),typeof history.pushState=="undefined")?(alert("Browser does not support HTML5."),!1):(i={Title:"new",Url:"/ticketitems/mytasks/"+t+"/"+n},history.pushState(i,i.Title,i.Url),!1)});jQuery(document).on("click",".addfavclient",function(){var n=jQuery(this),t=jQuery(this).siblings("section").data("clientid");return $.post("/ticketitems/addfavouriteclient/",{id:t},function(t){t.success==1&&jQuery(n).removeClass("fa-star-o").removeClass("addfavclient").addClass("fa-star").addClass("removefavclient")}),!1});jQuery(document).on("click",".removefavclient",function(){var n=jQuery(this),t=jQuery(this).data("userfavid");return $.post("/ticketitems/removefavouriteclient/",{id:t},function(t){t.success==1&&jQuery(n).removeClass("fa-star").removeClass("removefavclient").addClass("fa-star-o").addClass("addfavclient")}),!1})});