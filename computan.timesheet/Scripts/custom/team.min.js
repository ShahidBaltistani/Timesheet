function initDocument(){initControls()}function initControls(){jQuery("#AssignmentFromDate").datepicker();jQuery("#AssignmentToDate").datepicker();jQuery("#projects").select2();jQuery("#clients").select2();jQuery("#ByUsers").select2();jQuery("#ToUsers").select2();$("#ticketprojectid").select2();$("#ticketskillid").select2();$("#StartDate").datepicker();$("#EndDate").datepicker();loadUsersTagInputs();loadTeamsTagInputs();jQuery("#tid").select2()}function loadUsersTagInputs(){var n=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("text"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,prefetch:{url:"/tickets/PrefetchUsers",prepare:function(n){return n.type="POST",n.contentType="application/json; charset=UTF-8",n},remote:function(n,t){return t.type="POST",t.data={q:n,foo:"bar"},t}}});n.initialize();elt=$(".assignedusersinput");elt.tagsinput({itemValue:"value",itemText:"text"});elt.tagsinput("input").typeahead(null,{name:"assignedusers",valueKey:"value",displayKey:"text",source:n.ttAdapter(),templates:"<p>{{text}}<\/p>"}).bind("typeahead:selected",$.proxy(function(n,t){this.tagsinput("add",t);this.tagsinput("input").typeahead("val","")},elt))}function loadTeamsTagInputs(){var n=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("text"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,prefetch:{url:"/tickets/PrefetchTeams",prepare:function(n){return n.type="POST",n.contentType="application/json; charset=UTF-8",n},remote:function(n,t){return t.type="POST",t.data={q:n,foo:"bar"},t}}});n.initialize();elt=$(".assignedteaminput");elt.tagsinput({itemValue:"value",itemText:"text"});elt.tagsinput("input").typeahead(null,{name:"assignedteams",valueKey:"value",displayKey:"text",source:n.ttAdapter(),templates:"<p>{{text}}<\/p>"}).bind("typeahead:selected",$.proxy(function(n,t){this.tagsinput("add",t);this.tagsinput("input").typeahead("val","")},elt))}function filterTicketsForTeam(){if(jQuery("#IsAdmin").val()==0){var n=jQuery("#CurrentUserId").val();jQuery("#ToUsers").val(n).trigger("change")}}function filter(){var n="?teamid="+$("#teamid").val()+"&ByUsers="+$("#ByUsers").val()+"&ToUsers="+$("#ToUsers").val()+"&AssignmentFromDate="+$("#AssignmentFromDate").val()+"&AssignmentToDate="+$("#AssignmentToDate").val()+"&clientid="+$("#clients").val()+"&projectid="+$("#projects").val()+"&ticketTitle="+$("#tTitle").val();$.ajax({url:"/Home/teamAjax"+n,type:"GET"}).done(function(n){return $("#statusList").html(n),setTimeout(function(){bindEvent()},50),!1})}jQuery(document).ready(function(){initDocument();filterTicketsForTeam();jQuery("#clients").change(function(){$("#projects").val("").trigger("change");var n=$(this).val();n==""?$.getJSON("/tickettimeLogs/loadallprojects",function(n){var t=$("#projects");t.empty();t.append($("<option/>",{value:"",text:"Please Select"}));$.each(n,function(n,i){t.append($("<option/>",{value:i.Value,text:i.Text}))})}):$.getJSON("/tickettimeLogs/loadprojectsbyclient",{id:n},function(n){var t=$("#projects");t.empty();t.append($("<option/>",{value:"",text:"Select a project"}));$.each(n,function(n,i){t.append($("<option/>",{value:i.Value,text:i.Text}))})})});jQuery(document).on("click",".archiveTicket",function(){var n=$(this).data("ticketid");$.ajax({url:"/tickets/ArchivedTicket/",data:{ticketcsv:n},type:"POST"}).done(function(n){return n.error?(alert(n.errortext),!1):($.each(n.tickets,function(n,t){var r=$("li#"+t.toString()),i;r.animate({backgroundColor:"yellow"},1e3).fadeOut(1e3,function(){$(r).remove()});i=$("#donecounter").html();i=parseInt(i);i=i-1;$("#donecounter").html(i)}),!1)})});jQuery("#btnLoad").click(function(){filter()});jQuery(document).on("click",".moveteam",function(){var n,t;jQuery(this).closest("li").hasClass("has-assignment")?jQuery("#MoveTeamModel").find(".assignmentwarning").removeClass("hide"):jQuery("#MoveTeamModel").find(".assignmentwarning").addClass("hide");n=jQuery(this).data("ticketid");jQuery(".move-team").data("ticketid",n);t=jQuery(this).data("btnteamid");jQuery(".move-team").data("btnteamid",t);jQuery("#MoveTeamModel").modal("toggle")});jQuery(document).on("click",".move-team",function(){var t=jQuery(this).data("btnteamid"),i=jQuery(this).data("ticketid"),n=$("#tid").find(":selected").val();if(n=="")return sweetAlert("Sorry","Please select a team from the list.","error"),!1;if(n==t)return sweetAlert("Sorry","Already assigned to this team","error"),!1;$.ajax({url:"/Home/ChangeTeam/",data:{teamid:t,ticketid:i,newteamid:n},type:"GET"}).done(function(n){if(n.error)return sweetAlert("Sorry",n.TextContext,"error"),!1;new PNotify({title:"Success",text:n.TextContext,type:"success",hide:!0});jQuery("#"+i).remove();jQuery("#MoveTeamModel").modal("toggle")})});jQuery(document).on("click",".assignticketaction",function(){jQuery("#ticketprojectid").val("").trigger("change");jQuery("#ticketskillid").val("").trigger("change");jQuery("#estimateTimeInput").val("").trigger("change");jQuery(".assignedusersinput").tagsinput("removeAll");jQuery(".assignedteaminput").tagsinput("removeAll");jQuery("#ticketcomment").val("");var n=jQuery(this).data("ticketid"),t=jQuery(this).data("projectid"),i=jQuery(this).data("skillid");jQuery("#AssignmentDialogTicketId").val(n);t!=""&&jQuery("#ticketprojectid").val(t).trigger("change");i!=""&&jQuery("#ticketskillid").val(i).trigger("change");$.ajax({url:"/Home/FetchUsersAndTeams/",data:{Ticketid:n},type:"GET"}).done(function(t){if(t.error==1)return sweetAlert("Sorry",t.TextContext,"error"),!1;t.Users!=null&&$(t.Users).each(function(n,t){jQuery(".assignedusersinput").tagsinput("add",{value:t.Id,text:t.FullName})});t.Teams!=null&&$(t.Teams).each(function(n,t){jQuery(".assignedteaminput").tagsinput("add",{value:t.id,text:t.name})});$.ajax({url:"/Home/FetchEstimatetasktime/",data:{Ticketid:n},type:"GET"}).done(function(n){jQuery("#estimateTimeInput").val(n.estimatetime).trigger("change");jQuery("#EstimateTimeHidden").val(n.estimatetime).trigger("change")});jQuery(".tag").removeClass("label-info").addClass("label-success");jQuery("#ticketAssignModal").modal("toggle")})});$(document).on("click",".add-new-skill",function(){$("#skillname").val("");$("#AddSkillModal").modal("toggle")});$(document).on("click",".add-new-project",function(){jQuery("#clientid").select2();$("#AddProjectModal").modal("toggle")});$("#AddProjectModal").on("hidden.bs.modal",function(){$(this).find("#projectname").val("");$(this).find("textarea,select").val("").end()});jQuery(document).on("click",".add-project",function(){var n=$("#clientid").val(),t=$("#projectname").val();if(n==null||n=="")return sweetAlert("Sorry","Please select a client from the list.","error"),!1;if(t==null||t=="")return sweetAlert("Sorry","Please add the project name.","error"),!1;$.ajax({url:"/home/AddProject/",data:{clientid:n,projectname:t},type:"POST"}).done(function(n){if(n.error)return alert(n.message),!1;$("#ticketprojectid").append($("<option>",{value:n.prid,text:n.prname}));new PNotify({title:"Success",text:"The project has been successfully added.",type:"success"});jQuery("#AddProjectModal").modal("hide")})});jQuery(document).on("click",".add-skill",function(){var n=$("#skillname").val();if(n==""||n==null)return sweetAlert("Sorry","Please add the skill name.","error"),!1;$.ajax({url:"/home/AddSkill/",data:{name:n},type:"POST"}).done(function(n){if(n.error)return alert(n.message),!1;$("#ticketskillid").append($("<option>",{value:n.skid,text:n.skname}));new PNotify({title:"Success",text:"The skill has been added successfully.",type:"success"});jQuery("#AddSkillModal").modal("hide")})})});jQuery(document).on("click",".add-fav-ticket",function(){var n=$(this),t=n.closest("li").data("itemid");n.removeClass("add-fav-ticket").removeClass("fa-star-o").addClass("fa-star").addClass("remove-fav-ticket");$.ajax({url:"/tickets/AddFavouriteTickets",type:"Post",data:{ticketid:t},success:function(t){t.success==1?new PNotify({title:"Success",text:"Ticket flag successfully added ",type:"success"}):(new PNotify({title:"Success",text:"Error occour! ticket flag is not added",type:"error"}),n.removeClass("remove-fav-ticket").removeClass("fa-star").addClass("fa-star-o").addClass("add-fav-ticket"))}})});jQuery(document).on("click",".remove-fav-ticket",function(){var n=$(this),t=n.closest("li").data("itemid");n.removeClass("remove-fav-ticket").removeClass("fa-star").addClass("fa-star-o").addClass("add-fav-ticket");$.ajax({url:"/tickets/RemoveFavouriteTickets",type:"Post",data:{ticketid:t},success:function(t){t.success==1?new PNotify({title:"Success",text:"Ticket flag removed successfully ",type:"success"}):(new PNotify({title:"Error",text:"Error Occour! flag is not remove try again",type:"error"}),n.removeClass("add-fav-ticket").removeClass("fa-star-o").addClass("fa-star").addClass("remove-fav-ticket"))}})});