$(document).ready(function(){function n(){$(".arrow-click").attr("aria-expanded","false");$(".arrow-click").addClass("collapsed");$(".clientDashboard .panel-collapse").attr("aria-expanded","false");$(".clientDashboard .panel-collapse").removeClass("in");$(".arrow-click i").removeClass("fa-caret-down").addClass("fa-caret-right");$("#assign-project").select2();$("#assign-skills").select2();$("#users").select2();t();i()}function t(){var n=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("text"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,prefetch:{url:"/tickets/PrefetchUsers",prepare:function(n){return n.type="POST",n.contentType="application/json; charset=UTF-8",n},remote:function(n,t){return t.type="POST",t.data={q:n,foo:"bar"},t}}});n.initialize();elt=$(".assignedusersinput");elt.tagsinput({itemValue:"value",itemText:"text"});elt.tagsinput("input").typeahead(null,{name:"assignedusers",valueKey:"value",displayKey:"text",source:n.ttAdapter(),templates:"<p>{{text}}<\/p>"}).bind("typeahead:selected",$.proxy(function(n,t){this.tagsinput("add",t);this.tagsinput("input").typeahead("val","")},elt))}function i(){var n=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("text"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,prefetch:{url:"/tickets/PrefetchTeams",prepare:function(n){return n.type="POST",n.contentType="application/json; charset=UTF-8",n},remote:function(n,t){return t.type="POST",t.data={q:n,foo:"bar"},t}}});n.initialize();elt=$(".assignedteaminput");elt.tagsinput({itemValue:"value",itemText:"text"});elt.tagsinput("input").typeahead(null,{name:"assignedteams",valueKey:"value",displayKey:"text",source:n.ttAdapter(),templates:"<p>{{text}}<\/p>"}).bind("typeahead:selected",$.proxy(function(n,t){this.tagsinput("add",t);this.tagsinput("input").typeahead("val","")},elt))}function r(){$.ajax({type:"GET",url:"/Clients/GetSkills",dataType:"json",success:function(n){$("#assign-skills").html("");$("#assign-skills").append("<option value='' selected disabled > Select Skills <\/option >");$.each(n,function(n,t){var i;i="<option value='"+t.id+"'>"+t.name+"<\/option>";$("#assign-skills").append(i)})}})}function u(){$.ajax({type:"GET",url:"/Clients/GetProjects",dataType:"json",success:function(n){$("#assign-project").html("");$("#assign-project").append("<option value='' selected disabled > Select Projects <\/option >");$.each(n,function(n,t){var i;i="<option value='"+t.Value+"'>"+t.Text+"<\/option>";$("#assign-project").append(i)})}})}n();$("#btnsave").on("click",function(){var i=$("#last-projectid").val(),n=$("#assign-project").val(),r=$("#assign-skills").val(),u=$(".assignedusersinput").val(),f=$(".assignedteaminput").val(),t,e;if(n=="")return sweetAlert("Sorry","Please select a project from the list.","error"),!1;if(r==="")return sweetAlert("Sorry","Please select a skill from the list.","error"),!1;if(u==""&&f=="")return sweetAlert("Sorry! Assignment Missing","Please assign ticket to at least one user/team.","error"),!1;t=[];$("#collapsible-"+i+" input:checked").each(function(){t.push($(this).val())});e=t.join(",");$.ajax({url:"/Tickets/AssignMultipleTickets/",data:{projectid:n,skillid:r,ticketcsv:e,usercsv:u,shiftteamID:f},type:"POST"}).done(function(t){return t.error?($("#assignuseradmin").modal("hide"),!1):($.each(t.tickets,function(t,r){n===i&&$("#"+r).animate({backgroundColor:"yellow"},1e3).fadeOut(1e3,function(){$("#"+r).remove()});$("input:checkbox").prop("checked",!1)}),new PNotify({title:"Success",text:"The task has been assigned to selected users.",type:"success"}),$("#assign-project").val("").trigger("change"),$("#assign-skills").val("").trigger("change"),$(".assignedusersinput").val("").trigger("change"),$(".assignedteaminput").val("").trigger("change"),$("#assignuseradmin").modal("hide"),!1)})});$(".assign-multiple").on("click",function(){r();u();var n=$(this).parents("tr").data("id");$("."+n).find("input[type=checkbox]").is(":checked")?($("#assignuseradmin").modal("toggle"),$("#last-projectid").val(n),$("#assign-project").val(n).trigger("change")):new PNotify({title:"Warning!",text:"Please select at least one ticket!",type:"warning"})});$(".check-all").on("click",function(){var n=$(this).parents("tr").data("id");$(this).is(":checked")?$("."+n).prop("checked",!0):$("."+n).prop("checked",!1)}).change();$(".arrow-click").on("click",function(){var n=$(this).find("i");n.hasClass("fa-caret-right")?$(n).removeClass("fa-caret-right").addClass("fa-caret-down"):(n.removeClass("fa-caret-down"),n.addClass("fa-caret-right"))});jQuery(".assignedusersinput").on("beforeItemAdd",function(n){var t=n.item;$.ajax({url:"/tickets/PrefetchSingleTeams?UserID="+t.value,type:"GET"}).done(function(n){return n.error?(alert(JSON.stringify(n.errortext)),!1):(jQuery(".assignedteaminput").tagsinput("add",{value:n.teamid,text:n.teamName}),!1)})});jQuery(".assignedusersinput").on("beforeItemRemove",function(n){var t=n.item,i=jQuery("#AssignmentDialogTicketId").val();n.options&&n.options.preventPost||jQuery.post("/Tickets/RemoveTicketUser",{id:i,userid:t.value},function(n){return n.success||jQuery(".assignedusersinput").tagsinput("add",t,{preventPost:!0}),n.success&&new PNotify({title:"Success!",text:n.messagetext,type:"success"}),!0})})});