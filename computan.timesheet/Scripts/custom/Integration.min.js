function init(){$(".skill").select2();$(".project").select2();loadAssignedToTagInputs();loadnewTeamsTagInputs();loadusersandteam()}function loadusersandteam(){$.ajax({url:"/FreedCampProject/loadprojectuserandteam",type:"GET"}).done(function(n){return n.error||$.each(n.model,function(n,t){var r=t.users,u=t.teams,i=t.projectid;$.each(r,function(n,t){var r={value:t.userid,text:t.name};jQuery("#User-"+i).tagsinput("add",r,{preventPost:!0})});$.each(u,function(n,t){var r={value:t.teamid,text:t.name};jQuery("#Team-"+i).tagsinput("add",r,{preventPost:!0})})}),!1})}function loadnewTeamsTagInputs(){var n=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("text"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,prefetch:{url:"/tickets/PrefetchTeams",prepare:function(n){return n.cache=!1,n.type="POST",n.contentType="application/json; charset=UTF-8",n},remote:function(n,t){return t.cache=!1,t.type="POST",t.data={q:n,foo:"bar"},t}}}),t;n.initialize();t=$(".teamassign");t.each(function(){elt=$(this);elt.tagsinput({itemValue:"value",itemText:"text"});elt.tagsinput("input").typeahead(null,{name:"assignedteams",valueKey:"value",displayKey:"text",source:n.ttAdapter(),templates:"<p>{{text}}<\/p>"}).bind("typeahead:selected",$.proxy(function(n,t){this.tagsinput("add",t);this.tagsinput("input").typeahead("val","")},elt))})}function loadAssignedToTagInputs(){var n=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("text"),queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,prefetch:{ttl:1,url:"/tickets/PrefetchUsers",prepare:function(n){return n.type="POST",n.contentType="application/json; charset=UTF-8",n},remote:function(n,t){return t.type="POST",t.data={q:n,foo:"bar"},t}}}),t;n.clear();n.clearPrefetchCache();n.clearRemoteCache();n.initialize();t=$(".userassign");t.each(function(){elt=$(this);elt.tagsinput({itemValue:"value",itemText:"text"});elt.tagsinput("input").typeahead(null,{name:"assignedusers",valueKey:"value",displayKey:"text",source:n.ttAdapter(),templates:"<p>{{text}}<\/p>"}).bind("typeahead:selected",$.proxy(function(n,t){this.tagsinput("add",t);this.tagsinput("input").typeahead("val","")},elt))})}jQuery(function(){jQuery(document).on("beforeItemRemove",".teamassign",function(n){var r=n.item,u=$(this).val(),f=r.value,t=u.replace(f,""),i;t=t.replace(",,",",");i=$(this).closest("tr").data("id");n.options&&n.options.preventPost||$.ajax({url:"/FreedCampProject/RemoveTeams",type:"GET",data:{id:i,teamscsv:t}}).done(function(n){if(n.error)return jQuery("#team"+i).tagsinput("add",r,{preventPost:!0}),alert(n.Message),!1;new PNotify({title:"Success!",text:n.Message,type:"success",hide:!0,buttons:{sticker:!1}})})});jQuery(document).on("beforeItemRemove",".userassign",function(n){var r=n.item,u=$(this).val(),f=r.value,t=u.replace(f,""),i;t=t.replace(",,",",");i=$(this).closest("tr").data("id");n.options&&n.options.preventPost||$.ajax({url:"/FreedCampProject/RempoveUsers",type:"GET",data:{id:i,usercsv:t}}).done(function(n){if(n.error)return jQuery("#User-"+i).tagsinput("add",r,{preventPost:!0}),alert(n.Message),!1;new PNotify({title:"Success!",text:n.Message,type:"success",hide:!0,buttons:{sticker:!1}})})});jQuery(document).on("beforeItemAdd",".teamassign",function(n){var t=n.item,i=$(this).closest("tr").data("id");n.options&&n.options.preventPost||jQuery.post("/FreedCampProject/AddTeams",{id:i,teamid:t.value},function(n){n.error?jQuery("#Team-"+i).tagsinput("remove",t,{preventPost:!0}):n.teamadded?new PNotify({title:"Success!",text:n.Message,type:"success",hide:!0,buttons:{sticker:!1}}):jQuery("#Team-"+i).tagsinput("remove",t,{preventPost:!0})})});jQuery(document).on("beforeItemAdd",".userassign",function(n){var i=n.item,r=$(this).closest("tr"),u=r.find(".project").val(),f=r.find(".skill").val(),t=$(this).closest("tr").data("id");if(!n.options||!n.options.preventPost){if(u===""||u===null||f===""||f===null)return!1;$.ajax({url:"/FreedCampProject/AddUsers",type:"GET",data:{id:t,userid:i.value}}).done(function(n){if(n.error)return alert(n.Message),!1;n.teamadd&&jQuery("#Team-"+t).tagsinput("add",{value:n.team_id,text:n.teamName},{preventPost:!0});n.useradd||jQuery("#User-"+t).tagsinput("remove",i,{preventPost:!0});new PNotify({title:"Success!",text:n.Message,type:"success",hide:!0,buttons:{sticker:!1}})})}});jQuery(document).on("itemAdded",".userassign",function(n){var t=n.item,i=$(this).closest("tr"),r=i.find(".project").val(),u=i.find(".skill").val(),f=$(this).closest("tr").data("id");if(!n.options||!n.options.preventPost){if(r===""||r===null)return new PNotify({title:"Error!",text:"Please select project",type:"error",hide:!0,buttons:{sticker:!1}}),jQuery("#User-"+f).tagsinput("remove",t,{preventPost:!0}),!1;if(u===""||u===null)return new PNotify({title:"Error!",text:"Please select skill",type:"error",hide:!0,buttons:{sticker:!1}}),$("#User-"+f).tagsinput("remove",t,{preventPost:!0}),!1}});jQuery(document).on("change",".skill",function(){var n=$(this).val(),t;(n==null||n=="")&&(n=0);t=$(this).closest("tr").data("id");$.ajax({url:"/FreedCampProject/AddSkill",data:{id:t,skillid:n},type:"Post"}).done(function(n){return new PNotify({title:"Success!",text:n.Message,type:"success",hide:!0,buttons:{sticker:!1}}),!1})});jQuery(document).on("change",".project",function(){var n=$(this).val(),t;(n==null||n=="")&&(n=0);t=$(this).closest("tr").data("id");$.ajax({url:"/FreedCampProject/AddProject",data:{id:t,projectid:n},type:"Post"}).done(function(n){return new PNotify({title:"Success!",text:n.Message,type:"success",hide:!0,buttons:{sticker:!1}}),!1})})});