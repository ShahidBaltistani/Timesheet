@model IEnumerable<computan.timesheet.core.Project>
@{ ViewBag.Title = "Projects"; }
<div class="panel panel-default" id="maincontent">
    @Html.Partial("_NavTabs", "projects")
    <div class="panel">
        <div class="panel-heading bg-teal-700">
            <div class="row">
                <div class="col-xs-12">
                    <div class="col-xs-12 col-sm-7">
                        <h4 class="panel-title ticket-title">
                            <span>Projects Listing </span>
                        </h4>
                    </div>
                    <div class="col-xs-12 col-sm-5">
                        <div class="heading-elements">
                            <ul class="icons-list">
                                <li>
                                    <button class="label border-left-primary label-striped" onclick="window.location.href = '/projects/create'">Add New Project</button>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel panel-flat">
            <div id="DataTables_Table_0_wrapper" class="dataTables_wrapper no-footer">
                <div class="datatable-scroll">
                    <table class="table" id="DataTables_Table_0" role="grid" aria-describedby="DataTables_Table_0_info">
                        <thead>
                        <tr role="row">
                            <th> @Html.Raw("Client Name") </th>
                            <th> @Html.DisplayNameFor(model => model.name) </th>
                            <th> @Html.DisplayNameFor(model => model.projectmanager) </th>
                            <th> @Html.DisplayNameFor(model => model.description) </th>
                            <th> @Html.DisplayNameFor(model => model.startdate) </th>
                            <th> @Html.DisplayNameFor(model => model.completiondate) </th>
                            <th> @Html.DisplayName("Status") </th>
                            <th></th>
                        </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<input type="hidden" id="statusFilter" value="1"/>
<script type="text/javascript">
    $(document).ready(function() {
        var ctable = $('#DataTables_Table_0').DataTable({
            "processing": true,
            "serverSide": true,
            "ordering": false,
            "scrollY": "600px",
            "sScrollX": true,
            "fixedHeader": true,
            "scrollCollapse": true,
            "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
            "ajax": {
                "url": "/Projects/GetData",
                "type": "GET",
                "data": function(data) { data.filter = $('#statusFilter').val() == 'null' ? null : ($('#statusFilter').val() == '1' ? true : false); },
                "datatype": "json"
            },
            "columnDefs": [
                { "targets": 0, "data": "clientname", "render": function(data) { return "<div style='white-space: normal; max-width: 150px;'>" + data + "</div>"; } },
                {
                    "targets": 1,
                    "data": "name",
                    "data": { "name": "name", "id": "id" },
                    "render": function(data) {
                        if (data != null) {
                            return '<a style="white-space: normal; max-width: 100px;" href="/credentials/projectcredentials/' + data.id + '" target="_blank">' + data.name + '</a>';
                        }
                        return "";
                    }
                },
                { "targets": 2, "data": "projectmanager", "render": function(data) { return data; } },
                {
                    "targets": 3,
                    "data": "description",
                    "render": function(data) {
                        if (data != null) {
                            return "<div style='white-space: normal; max-width: 300px;'>" + data + "</div>";
                        }
                        return "";
                    }
                },
                {
                    "targets": 4,
                    "data": "startdate",
                    "render": function(data) {
                        if (data != null) {
                            return moment(data).format("D/MM/YYYY");
                        }
                        return "";
                    }
                },
                {
                    "targets": 5,
                    "data": "completiondate",
                    "render": function(data) {
                        if (data != null) {
                            return moment(data).format("D/MM/YYYY");
                        }
                        return "";
                    }
                },
                {
                    "targets": 6,
                    "data": "isactive",
                    "render": function(data) {
                        if (data == true) {
                            return '<span class="label label-success">Active</span>';
                        }
                        return '<span class="label label-danger">In-Active</span>';
                    }
                },
                {
                    "targets": 7,
                    "data": "id",
                    "render": function(data) {
                        return '<a class="btn btn-primary btn-xs" href="/Projects/Edit/' +
                            data +
                            '" >Edit</a>&nbsp;' +
                            '<a class="btn btn-primary btn-xs" href="/project/index/' +
                            data +
                            '" target="_blank">Dashboard</a>';
                    }
                }
            ],
            buttons: {
                dom: { button: { className: 'btn btn-default' } },
                buttons: [
                    { extend: 'copyHtml5', exportOptions: { columns: 'th:not(:last-child)' } },
                    { extend: 'excelHtml5', exportOptions: { columns: 'th:not(:last-child)' } },
                    { extend: 'csvHtml5', exportOptions: { columns: 'th:not(:last-child)' } },
                    { extend: 'pdfHtml5', exportOptions: { columns: 'th:not(:last-child)' } }
                ]
            }
        });
        $(".dataTables_length").before($("#status-radiobutton-template").html());
        $('input[name="optradio"]').change(function() {
            $('input[name="optradio"]').closest("label").removeClass('btn-primary').addClass('btn-default');
            $('#statusFilter').val($('input[name="optradio"]:checked').val());
            $('input[name="optradio"]:checked').closest("label").removeClass('btn-default').addClass('btn-primary');
            ctable.columns.adjust().draw();
        });
        $('.dataTables_length select').select2({ minimumResultsForSearch: Infinity, width: 'auto' });
    });
</script>
<script id="status-radiobutton-template" type="text/x-handlebars-template">
    <div data-toggle="buttons" class="dt-buttons btn-group">
        <label class="btn btn-primary"> <input type="radio" name="optradio" value="1" checked="checked">Active </label>
        <label class="btn btn-default"> <input type="radio" name="optradio" value="0">In-Active </label>
        <label class="btn btn-default"> <input type="radio" name="optradio" value="null">All </label>
    </div>
</script>